# ğŸ“š CareCircle Complete Learning Guide

> Everything you need to understand, run, and extend the CareCircle caregiving coordination platform.

---

## Table of Contents

1. [Project Overview](#1-project-overview)
2. [Architecture Deep Dive](#2-architecture-deep-dive)
3. [Monorepo Structure](#3-monorepo-structure)
4. [Database Design](#4-database-design)
5. [Event-Driven Architecture](#5-event-driven-architecture)
6. [Real-Time Features](#6-real-time-features)
7. [Frontend Architecture](#7-frontend-architecture)
8. [API Design](#8-api-design)
9. [Security Implementation](#9-security-implementation)
10. [Running the Project](#10-running-the-project)
11. [Deployment Guide](#11-deployment-guide)

---

## 1. Project Overview

### What is CareCircle?

CareCircle is a **family caregiving coordination platform** that helps families manage care for elderly or ill loved ones.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         THE PROBLEM                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   "Dad fell last Tuesday and was in ER. My sister didn't know for           â”‚
â”‚    6 hours because we're in different time zones. His medication            â”‚
â”‚    list was in Mom's email, his doctor's contact was in my phone,           â”‚
â”‚    and the insurance card was at his house."                                â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  BEFORE CareCircle                 â”‚  AFTER CareCircle               â”‚ â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚   â”‚  "Sister didn't know for 6 hours"  â”‚  Everyone notified in 2 minutes â”‚ â”‚
â”‚   â”‚  "Medication list in Mom's email"  â”‚  All meds in one place          â”‚ â”‚
â”‚   â”‚  "Doctor's contact in my phone"    â”‚  All contacts shared            â”‚ â”‚
â”‚   â”‚  "Insurance card at his house"     â”‚  Documents accessible anywhere  â”‚ â”‚
â”‚   â”‚  "Shared Google Doc is chaos"      â”‚  Organized, real-time app       â”‚ â”‚
â”‚   â”‚  "Missed appointments"             â”‚  Calendar with reminders        â”‚ â”‚
â”‚   â”‚  "Double-booked caregivers"        â”‚  Shift scheduling               â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚   Common Pain Points:                                                       â”‚
â”‚   â€¢ Family members in different states/time zones                           â”‚
â”‚   â€¢ 5 doctors, 3 medications, weekly PT - no central tracking               â”‚
â”‚   â€¢ Shared Google Doc is chaos                                              â”‚
â”‚   â€¢ Missed appointments, double-booked caregivers                           â”‚
â”‚   â€¢ Medication errors                                                       â”‚
â”‚   â€¢ Emergency info scattered everywhere                                     â”‚
â”‚   â€¢ 6-hour delay in critical communication                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         THE SOLUTION: CARECIRCLE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                          â”‚    CareCircle     â”‚                              â”‚
â”‚                          â”‚  Central Hub for  â”‚                              â”‚
â”‚                          â”‚ Family Caregivers â”‚                              â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                    â”‚                                        â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚     â–¼              â–¼              â–¼              â–¼              â–¼          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ Meds   â”‚  â”‚  Calendar â”‚  â”‚ Emergency â”‚  â”‚ Family  â”‚  â”‚ Documents â”‚       â”‚
â”‚ â”‚Trackingâ”‚  â”‚Appointmentsâ”‚  â”‚  Alerts  â”‚  â”‚  Team   â”‚  â”‚   Vault   â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â”‚   âœ… One place for ALL care information                                     â”‚
â”‚   âœ… Real-time updates to all family members                                â”‚
â”‚   âœ… Emergency alerts in seconds, not hours                                 â”‚
â”‚   âœ… Medication logging & reminders                                         â”‚
â”‚   âœ… Caregiver shift coordination                                           â”‚
â”‚   âœ… Health timeline for doctor visits                                      â”‚
â”‚   âœ… Works offline (emergency info cached)                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tech Stack

| Layer | Technology | Why |
|-------|------------|-----|
| **Frontend** | Next.js 14 (App Router) | Server components, great DX, PWA support |
| **Backend** | NestJS | Enterprise-grade, TypeScript, modular |
| **Database** | PostgreSQL + Prisma | Relational data, ACID, JSON support, type-safe ORM |
| **Cache/Queue** | Redis + BullMQ | Fast cache, reliable job processing |
| **Message Broker** | RabbitMQ | Event-driven architecture, decoupling |
| **Real-time** | Socket.io | WebSocket support with fallbacks |
| **Storage** | Cloudinary | Document vault, image storage (third-party) |
| **Email** | Mailtrap | Email testing in development (third-party) |
| **Auth** | JWT + HTTP-only cookies | Secure, stateless auth |

---

## 2. Architecture Deep Dive

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HIGH-LEVEL ARCHITECTURE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                          â”‚   LOAD BALANCER  â”‚                               â”‚
â”‚                          â”‚    (Nginx/ALB)   â”‚                               â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                   â”‚                                         â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚           â”‚                       â”‚                       â”‚                 â”‚
â”‚           â–¼                       â–¼                       â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚   Next.js     â”‚       â”‚    NestJS     â”‚       â”‚    NestJS     â”‚        â”‚
â”‚   â”‚   Frontend    â”‚       â”‚   API Server  â”‚       â”‚   API Server  â”‚        â”‚
â”‚   â”‚   (Node.js)   â”‚       â”‚   Instance 1  â”‚       â”‚   Instance 2  â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚           â”‚                       â”‚                       â”‚                 â”‚
â”‚           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                 â”‚
â”‚           â”‚              â”‚                 â”‚              â”‚                 â”‚
â”‚           â–¼              â–¼                 â–¼              â–¼                 â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚       â”‚                     Redis Cluster                        â”‚          â”‚
â”‚       â”‚  â€¢ Session Cache    â€¢ Rate Limiting    â€¢ Pub/Sub        â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                   â”‚                                         â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚           â”‚                       â”‚                       â”‚                 â”‚
â”‚           â–¼                       â–¼                       â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚  PostgreSQL   â”‚       â”‚   RabbitMQ    â”‚       â”‚    BullMQ     â”‚        â”‚
â”‚   â”‚   Primary     â”‚       â”‚   Exchange    â”‚       â”‚    Worker     â”‚        â”‚
â”‚   â”‚   + Replicas  â”‚       â”‚   + Queues    â”‚       â”‚   Processes   â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TYPICAL REQUEST FLOW                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   User clicks "Log Medication"                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  1. FRONTEND (Next.js)                                               â”‚  â”‚
â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚     â”‚ const { mutate } = useMutation({                             â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   mutationFn: () => api.post('/medications/123/log', {       â”‚ â”‚  â”‚
â”‚   â”‚     â”‚     status: 'GIVEN',                                         â”‚ â”‚  â”‚
â”‚   â”‚     â”‚     notes: 'Took with breakfast'                             â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   }),                                                        â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   onMutate: () => updateCacheOptimistically(),               â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ });                                                          â”‚ â”‚  â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚                              â”‚                                       â”‚  â”‚
â”‚   â”‚                              â–¼                                       â”‚  â”‚
â”‚   â”‚  2. API SERVER (NestJS)                                              â”‚  â”‚
â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚     â”‚ â€¢ JwtAuthGuard validates access token                        â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â€¢ RolesGuard checks user has CAREGIVER or ADMIN role         â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â€¢ ValidationPipe validates request body                      â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â€¢ MedicationsController.log() called                         â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â€¢ MedicationsService.log() creates log entry                 â”‚ â”‚  â”‚
â”‚   â”‚     â”‚                                                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ await this.dataSource.transaction(async (em) => {            â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   const log = em.create(MedicationLog, { ... });             â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   await em.save(log);                                        â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ });                                                          â”‚ â”‚  â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚                              â”‚                                       â”‚  â”‚
â”‚   â”‚                              â–¼                                       â”‚  â”‚
â”‚   â”‚  3. EVENT PUBLISHING                                                 â”‚  â”‚
â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚     â”‚ await this.eventPublisher.publish(                           â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   'medication.logged',                                       â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   {                                                          â”‚ â”‚  â”‚
â”‚   â”‚     â”‚     medicationId, careRecipientId, status,                   â”‚ â”‚  â”‚
â”‚   â”‚     â”‚     loggedById, loggedByName                                 â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   },                                                         â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   `medication.${status.toLowerCase()}.${careRecipientId}`,   â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   '/api/v1/medications/123/log'                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ );                                                           â”‚ â”‚  â”‚
â”‚   â”‚     â”‚                                                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ Saved to outbox table (for reliability)                    â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ Immediately attempted to RabbitMQ                          â”‚ â”‚  â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚                              â”‚                                       â”‚  â”‚
â”‚   â”‚                              â–¼                                       â”‚  â”‚
â”‚   â”‚  4. EVENT CONSUMERS                                                  â”‚  â”‚
â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚     â”‚ WEBSOCKET CONSUMER:                                          â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ Sends to family members via Socket.io                      â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ UI updates in real-time                                    â”‚ â”‚  â”‚
â”‚   â”‚     â”‚                                                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ NOTIFICATION CONSUMER:                                       â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ Sends push notifications to family phones                  â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ "Sarah gave Dad his Metformin"                             â”‚ â”‚  â”‚
â”‚   â”‚     â”‚                                                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ AUDIT CONSUMER:                                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ Logs event for compliance                                  â”‚ â”‚  â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Monorepo Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MONOREPO STRUCTURE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   carecircle/                                                               â”‚
â”‚   â”œâ”€â”€ apps/                          # Applications                         â”‚
â”‚   â”‚   â”œâ”€â”€ api/                       # NestJS Backend API                   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ src/                                                          â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth/             # Authentication module                 â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user/             # User management                       â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ family/           # Family & invitations                  â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ care-recipient/   # Care recipient CRUD                   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ medications/      # Medication tracking                   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ appointments/     # Calendar & appointments               â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ documents/        # Document vault                        â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ emergency/        # Emergency alerts                      â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ timeline/         # Health timeline                       â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ caregiver-shifts/ # Shift management                      â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ notifications/    # Push notifications                    â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ gateway/          # WebSocket gateway                     â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ events/           # Event-driven architecture             â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ publishers/   # Event publishers                      â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ consumers/    # Event consumers                       â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ database/         # TypeORM config & migrations           â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ config/           # App configuration                     â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ system/           # Shared utilities                      â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ module/       # Mail, storage, etc.                   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ i18n/             # Internationalization                  â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ package.json                                                  â”‚
â”‚   â”‚   â”‚   â””â”€â”€ nest-cli.json                                                 â”‚
â”‚   â”‚   â”‚                                                                     â”‚
â”‚   â”‚   â”œâ”€â”€ web/                       # Next.js Frontend                     â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ src/                                                          â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app/              # App Router pages                      â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/       # Auth pages (login, register)          â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (app)/        # Protected app pages                   â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx    # Root layout                           â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ components/       # React components                      â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ui/           # Base UI (Button, Input, etc.)         â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...           # Feature components                    â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/            # React hooks                           â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ lib/              # Utils & API client                    â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ styles/           # Global CSS & Tailwind                 â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ public/               # Static assets                         â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sw.js             # Service worker                        â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ manifest.json     # PWA manifest                          â”‚
â”‚   â”‚   â”‚   â””â”€â”€ package.json                                                  â”‚
â”‚   â”‚   â”‚                                                                     â”‚
â”‚   â”‚   â””â”€â”€ workers/                   # Background Workers                   â”‚
â”‚   â”‚       â”œâ”€â”€ src/                                                          â”‚
â”‚   â”‚       â”‚   â”œâ”€â”€ workers/          # Job workers                           â”‚
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ medication-reminder.worker.ts                         â”‚
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ appointment-reminder.worker.ts                        â”‚
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ shift-reminder.worker.ts                              â”‚
â”‚   â”‚       â”‚   â”œâ”€â”€ scheduler.ts      # Cron job scheduler                    â”‚
â”‚   â”‚       â”‚   â””â”€â”€ index.ts          # Worker entry point                    â”‚
â”‚   â”‚       â””â”€â”€ package.json                                                  â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â”€ packages/                      # Shared Packages                      â”‚
â”‚   â”‚   â””â”€â”€ database/                  # Prisma Database Package              â”‚
â”‚   â”‚       â”œâ”€â”€ prisma/                                                       â”‚
â”‚   â”‚       â”‚   â””â”€â”€ schema.prisma     # Database schema                       â”‚
â”‚   â”‚       â”œâ”€â”€ src/                                                          â”‚
â”‚   â”‚       â”‚   â””â”€â”€ index.ts          # Prisma client export                  â”‚
â”‚   â”‚       â””â”€â”€ package.json                                                  â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â”€ env/                           # Environment Configurations           â”‚
â”‚   â”‚   â”œâ”€â”€ base.env                  # Shared config (JWT, Cloudinary, etc.) â”‚
â”‚   â”‚   â”œâ”€â”€ local.env                 # Local Docker services                 â”‚
â”‚   â”‚   â””â”€â”€ cloud.env                 # Cloud/production services             â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â”€ scripts/                       # Utility Scripts                      â”‚
â”‚   â”‚   â”œâ”€â”€ use-local.ps1             # Switch to local profile               â”‚
â”‚   â”‚   â”œâ”€â”€ use-cloud.ps1             # Switch to cloud profile               â”‚
â”‚   â”‚   â””â”€â”€ deploy-prod.ps1           # Production deployment                 â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â”€ docs/                          # Documentation                        â”‚
â”‚   â”‚   â”œâ”€â”€ guides/                   # Learning guides (you are here!)       â”‚
â”‚   â”‚   â”œâ”€â”€ getting-started/          # Quick start guides                    â”‚
â”‚   â”‚   â””â”€â”€ engineering-mastery/      # Production engineering docs           â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â”€ k8s/                           # Kubernetes manifests                 â”‚
â”‚   â”œâ”€â”€ docker-compose.yml             # Local development services           â”‚
â”‚   â”œâ”€â”€ docker-compose.prod.yml        # Production deployment                â”‚
â”‚   â”œâ”€â”€ pnpm-workspace.yaml            # pnpm workspace config                â”‚
â”‚   â”œâ”€â”€ turbo.json                     # Turborepo config                     â”‚
â”‚   â””â”€â”€ package.json                   # Root package.json                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why Monorepo?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MONOREPO BENEFITS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   1. SHARED DATABASE SCHEMA                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ // packages/database/prisma/schema.prisma                           â”‚   â”‚
â”‚   â”‚ model Medication {                                                  â”‚   â”‚
â”‚   â”‚   id              String @id @default(uuid())                       â”‚   â”‚
â”‚   â”‚   careRecipientId String                                            â”‚   â”‚
â”‚   â”‚   name            String                                            â”‚   â”‚
â”‚   â”‚   dosage          String                                            â”‚   â”‚
â”‚   â”‚   // ... full schema                                                â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ // Used by BOTH API and Workers!                                    â”‚   â”‚
â”‚   â”‚ // apps/api/src/... and apps/workers/src/...                        â”‚   â”‚
â”‚   â”‚ import { PrismaClient } from '@carecircle/database';                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   2. ATOMIC CHANGES                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ One commit can update:                                              â”‚   â”‚
â”‚   â”‚ â€¢ API endpoint                                                      â”‚   â”‚
â”‚   â”‚ â€¢ Frontend component                                                â”‚   â”‚
â”‚   â”‚ â€¢ Database schema                                                   â”‚   â”‚
â”‚   â”‚ â€¢ Documentation                                                     â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ No more "update API in PR #1, update frontend in PR #2"             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   3. SIMPLIFIED TOOLING                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ # Run EVERYTHING with one command                                   â”‚   â”‚
â”‚   â”‚ $ pnpm dev                                                          â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ # Build ALL apps                                                    â”‚   â”‚
â”‚   â”‚ $ pnpm build                                                        â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ # Filter to specific app                                            â”‚   â”‚
â”‚   â”‚ $ pnpm --filter @carecircle/api dev                                 â”‚   â”‚
â”‚   â”‚ $ pnpm --filter @carecircle/web dev                                 â”‚   â”‚
â”‚   â”‚ $ pnpm --filter @carecircle/workers dev                             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Database Design

### Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE SCHEMA (Prisma)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚    User     â”‚â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”‚  FamilyMember   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    Family    â”‚   â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚   â”‚ id (PK)     â”‚       â”‚  â”‚ userId (FK)     â”‚          â”‚ id (PK)      â”‚   â”‚
â”‚   â”‚ email       â”‚       â”‚  â”‚ familyId (FK)   â”‚          â”‚ name         â”‚   â”‚
â”‚   â”‚ passwordHashâ”‚       â”‚  â”‚ role            â”‚          â”‚ createdAt    â”‚   â”‚
â”‚   â”‚ fullName    â”‚       â”‚  â”‚ joinedAt        â”‚          â”‚ updatedAt    â”‚   â”‚
â”‚   â”‚ phone       â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”‚ emailVerifiedâ”‚      â”‚                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚                                      â”‚           â”‚
â”‚          â”‚              â”‚                                      â”‚           â”‚
â”‚          â–¼              â”‚                                      â–¼           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚   Session   â”‚       â”‚                              â”‚CareRecipient â”‚    â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚
â”‚   â”‚ id (PK)     â”‚       â”‚                              â”‚ id (PK)      â”‚    â”‚
â”‚   â”‚ userId (FK) â”‚       â”‚                              â”‚ familyId (FK)â”‚    â”‚
â”‚   â”‚ refreshTokenâ”‚       â”‚                              â”‚ firstName    â”‚    â”‚
â”‚   â”‚ expiresAt   â”‚       â”‚                              â”‚ lastName     â”‚    â”‚
â”‚   â”‚ ipAddress   â”‚       â”‚                              â”‚ dateOfBirth  â”‚    â”‚
â”‚   â”‚ userAgent   â”‚       â”‚                              â”‚ bloodType    â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                              â”‚ allergies[]  â”‚    â”‚
â”‚                         â”‚                              â”‚ conditions[] â”‚    â”‚
â”‚                         â”‚                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                     â”‚            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                     â”‚                                     â”‚            â”‚
â”‚   â–¼                     â–¼                                     â–¼            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ Medication   â”‚  â”‚ Appointment  â”‚  â”‚TimelineEntry â”‚  â”‚   Document   â”‚     â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚
â”‚ â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚     â”‚
â”‚ â”‚ recipientId  â”‚  â”‚ recipientId  â”‚  â”‚ recipientId  â”‚  â”‚ familyId     â”‚     â”‚
â”‚ â”‚ name         â”‚  â”‚ title        â”‚  â”‚ type         â”‚  â”‚ type         â”‚     â”‚
â”‚ â”‚ dosage       â”‚  â”‚ startTime    â”‚  â”‚ title        â”‚  â”‚ name         â”‚     â”‚
â”‚ â”‚ frequency    â”‚  â”‚ endTime      â”‚  â”‚ description  â”‚  â”‚ s3Key        â”‚     â”‚
â”‚ â”‚ scheduledTimesâ”‚ â”‚ location     â”‚  â”‚ vitals (JSON)â”‚  â”‚ mimeType     â”‚     â”‚
â”‚ â”‚ instructions â”‚  â”‚ status       â”‚  â”‚ severity     â”‚  â”‚ uploadedById â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚MedicationLog â”‚  â”‚EmergencyAlertâ”‚  â”‚CaregiverShiftâ”‚  â”‚FamilyInvite  â”‚     â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚
â”‚ â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚     â”‚
â”‚ â”‚ medicationId â”‚  â”‚ recipientId  â”‚  â”‚ recipientId  â”‚  â”‚ familyId     â”‚     â”‚
â”‚ â”‚ status       â”‚  â”‚ type         â”‚  â”‚ caregiverId  â”‚  â”‚ email        â”‚     â”‚
â”‚ â”‚ scheduledTimeâ”‚  â”‚ createdById  â”‚  â”‚ startTime    â”‚  â”‚ role         â”‚     â”‚
â”‚ â”‚ givenTime    â”‚  â”‚ status       â”‚  â”‚ endTime      â”‚  â”‚ token        â”‚     â”‚
â”‚ â”‚ givenById    â”‚  â”‚ resolvedAt   â”‚  â”‚ checkedInAt  â”‚  â”‚ expiresAt    â”‚     â”‚
â”‚ â”‚ notes        â”‚  â”‚ description  â”‚  â”‚ checkedOutAt â”‚  â”‚ status       â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ notes        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚ â”‚   Doctor     â”‚  â”‚EmergencyContactâ”‚ â”‚ Notificationâ”‚                       â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
â”‚ â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚                       â”‚
â”‚ â”‚ recipientId  â”‚  â”‚ recipientId  â”‚  â”‚ userId       â”‚                       â”‚
â”‚ â”‚ name         â”‚  â”‚ name         â”‚  â”‚ type         â”‚                       â”‚
â”‚ â”‚ specialty    â”‚  â”‚ relationship â”‚  â”‚ title        â”‚                       â”‚
â”‚ â”‚ phone        â”‚  â”‚ phone        â”‚  â”‚ body         â”‚                       â”‚
â”‚ â”‚ email        â”‚  â”‚ isPrimary    â”‚  â”‚ read         â”‚                       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Multi-Tenancy (Family-Based)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MULTI-TENANCY MODEL                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   CareCircle uses FAMILY-BASED multi-tenancy:                               â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Family: "Thompson Family"                                         â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Members:                                                      â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Sarah Thompson (ADMIN)                                    â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Mike Thompson (CAREGIVER)                                 â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ Jennifer Thompson (VIEWER)                                â”‚   â”‚
â”‚   â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Care Recipients:                                              â”‚   â”‚
â”‚   â”‚       â””â”€â”€ Margaret "Grandma Maggie" Thompson                        â”‚   â”‚
â”‚   â”‚           â”œâ”€â”€ Medications                                           â”‚   â”‚
â”‚   â”‚           â”œâ”€â”€ Appointments                                          â”‚   â”‚
â”‚   â”‚           â”œâ”€â”€ Documents                                             â”‚   â”‚
â”‚   â”‚           â”œâ”€â”€ Timeline                                              â”‚   â”‚
â”‚   â”‚           â””â”€â”€ Emergency Info                                        â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   DATA ISOLATION:                                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚                                                                             â”‚
â”‚   // Every query is scoped to the user's family!                            â”‚
â”‚                                                                             â”‚
â”‚   // WRONG (security risk!)                                                 â”‚
â”‚   const meds = await medicationRepo.find({                                  â”‚
â”‚     where: { careRecipientId }  // Could access ANY family's data!          â”‚
â”‚   });                                                                       â”‚
â”‚                                                                             â”‚
â”‚   // RIGHT (family-scoped)                                                  â”‚
â”‚   const meds = await medicationRepo.find({                                  â”‚
â”‚     where: {                                                                â”‚
â”‚       careRecipient: {                                                      â”‚
â”‚         familyId: user.currentFamilyId  // Scoped to user's family          â”‚
â”‚       }                                                                     â”‚
â”‚     }                                                                       â”‚
â”‚   });                                                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Event-Driven Architecture

### Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EVENT-DRIVEN ARCHITECTURE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   WHY EVENT-DRIVEN?                                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚                                                                             â”‚
â”‚   WITHOUT Events:                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ async logMedication(dto: LogMedicationDto) {                        â”‚   â”‚
â”‚   â”‚   const log = await this.medicationRepo.save(dto);                  â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   // All of this runs IN THE REQUEST                                â”‚   â”‚
â”‚   â”‚   await this.sendPushNotifications(log);      // 200ms              â”‚   â”‚
â”‚   â”‚   await this.sendWebSocketUpdate(log);        // 50ms               â”‚   â”‚
â”‚   â”‚   await this.createAuditLog(log);             // 100ms              â”‚   â”‚
â”‚   â”‚   await this.updateDashboardCache(log);       // 75ms               â”‚   â”‚
â”‚   â”‚   await this.checkForInteractions(log);       // 150ms              â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   return log;  // Total: 575ms+ response time! ğŸ˜±                   â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   WITH Events:                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ async logMedication(dto: LogMedicationDto) {                        â”‚   â”‚
â”‚   â”‚   const log = await this.medicationRepo.save(dto);                  â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   // Just publish event and return immediately!                     â”‚   â”‚
â”‚   â”‚   await this.eventPublisher.publish(                                â”‚   â”‚
â”‚   â”‚     'medication.logged',                                            â”‚   â”‚
â”‚   â”‚     { medicationId: log.id, status: log.status, ... }               â”‚   â”‚
â”‚   â”‚   );                                                                â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   return log;  // Response in ~20ms! ğŸš€                             â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ // Everything else happens ASYNCHRONOUSLY via consumers             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EVENT FLOW DIAGRAM                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚      API Service        â”‚                              â”‚
â”‚                    â”‚  (MedicationsService)   â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                â”‚                                            â”‚
â”‚                                â”‚ 1. Save to DB                              â”‚
â”‚                                â–¼                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚       PostgreSQL        â”‚                              â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                              â”‚
â”‚                    â”‚  â”‚ medication_logs â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚ event_outbox â†â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€ 2. Write to outbox         â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    (same transaction)        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                â”‚                                            â”‚
â”‚                                â”‚ 3. Outbox processor reads                  â”‚
â”‚                                â–¼    every 10 seconds                        â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚    Outbox Processor     â”‚                              â”‚
â”‚                    â”‚    (Cron Job)           â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                â”‚                                            â”‚
â”‚                                â”‚ 4. Publish to RabbitMQ                     â”‚
â”‚                                â–¼                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚       RabbitMQ          â”‚                              â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                              â”‚
â”‚                    â”‚  â”‚ Domain Exchange â”‚â”€â”€â”€â”€â”¼â”€â”€â”                           â”‚
â”‚                    â”‚  â”‚    (topic)      â”‚    â”‚  â”‚                           â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚                           â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                           â”‚
â”‚                                                 â”‚                           â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚          â”‚                                      â”‚                  â”‚        â”‚
â”‚          â–¼                                      â–¼                  â–¼        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   WebSocket     â”‚                 â”‚  Notification   â”‚  â”‚    Audit    â”‚  â”‚
â”‚   â”‚   Consumer      â”‚                 â”‚   Consumer      â”‚  â”‚   Consumer  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                                   â”‚                  â”‚         â”‚
â”‚            â”‚ 5a. Emit via Socket.io            â”‚ 5b. Send push    â”‚ 5c. Log â”‚
â”‚            â–¼                                   â–¼                  â–¼         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ Family Members  â”‚                 â”‚  Push Service   â”‚  â”‚ Audit Log   â”‚  â”‚
â”‚   â”‚    (Browser)    â”‚                 â”‚ (Web Push/FCM)  â”‚  â”‚  (DB/SIEM)  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Real-Time Features

### WebSocket Implementation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WEBSOCKET IMPLEMENTATION                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   BACKEND (NestJS Gateway):                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ @WebSocketGateway({                                                 â”‚   â”‚
â”‚   â”‚   cors: { origin: FRONTEND_URL, credentials: true },                â”‚   â”‚
â”‚   â”‚   namespace: '/carecircle',                                         â”‚   â”‚
â”‚   â”‚ })                                                                  â”‚   â”‚
â”‚   â”‚ export class CareCircleGateway implements OnGatewayConnection {     â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   // Map: familyId â†’ Set of socket IDs                              â”‚   â”‚
â”‚   â”‚   private familyRooms = new Map<string, Set<string>>();             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   async handleConnection(client: Socket) {                          â”‚   â”‚
â”‚   â”‚     // 1. Verify JWT from cookie                                    â”‚   â”‚
â”‚   â”‚     const token = client.handshake.headers.cookie?.accessToken;     â”‚   â”‚
â”‚   â”‚     const user = await this.jwtService.verify(token);               â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚     // 2. Join user to their family's room                          â”‚   â”‚
â”‚   â”‚     client.join(`family:${user.familyId}`);                         â”‚   â”‚
â”‚   â”‚   }                                                                 â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   // Called by WebSocket consumer when events arrive                â”‚   â”‚
â”‚   â”‚   sendToFamily(familyId: string, event: string, data: any) {        â”‚   â”‚
â”‚   â”‚     this.server.to(`family:${familyId}`).emit(event, data);         â”‚   â”‚
â”‚   â”‚   }                                                                 â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   FRONTEND (React Hook):                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ // hooks/use-websocket.ts                                           â”‚   â”‚
â”‚   â”‚ export function useWebSocket() {                                    â”‚   â”‚
â”‚   â”‚   const [socket, setSocket] = useState<Socket | null>(null);        â”‚   â”‚
â”‚   â”‚   const queryClient = useQueryClient();                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   useEffect(() => {                                                 â”‚   â”‚
â”‚   â”‚     const socket = io(`${API_URL}/carecircle`, {                    â”‚   â”‚
â”‚   â”‚       withCredentials: true,  // Send cookies                       â”‚   â”‚
â”‚   â”‚       transports: ['websocket', 'polling'],                         â”‚   â”‚
â”‚   â”‚     });                                                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚     // Update React Query cache when events arrive                  â”‚   â”‚
â”‚   â”‚     socket.on('medication.logged', (data) => {                      â”‚   â”‚
â”‚   â”‚       queryClient.invalidateQueries(['medications']);               â”‚   â”‚
â”‚   â”‚       toast.info(`${data.loggedByName} logged medication`);         â”‚   â”‚
â”‚   â”‚     });                                                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚     socket.on('emergency.alert.created', (data) => {                â”‚   â”‚
â”‚   â”‚       // Critical: show modal, play sound!                          â”‚   â”‚
â”‚   â”‚       showEmergencyModal(data);                                     â”‚   â”‚
â”‚   â”‚       playAlertSound();                                             â”‚   â”‚
â”‚   â”‚     });                                                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚     setSocket(socket);                                              â”‚   â”‚
â”‚   â”‚     return () => socket.close();                                    â”‚   â”‚
â”‚   â”‚   }, []);                                                           â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   return socket;                                                    â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Push Notifications

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PUSH NOTIFICATIONS                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   We use Web Push API (VAPID) for push notifications:                       â”‚
â”‚                                                                             â”‚
â”‚   1. USER SUBSCRIBES (Frontend):                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ // Register service worker                                          â”‚   â”‚
â”‚   â”‚ const registration = await navigator.serviceWorker.register('/sw.js'); â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ // Subscribe to push                                                â”‚   â”‚
â”‚   â”‚ const subscription = await registration.pushManager.subscribe({     â”‚   â”‚
â”‚   â”‚   userVisibleOnly: true,                                            â”‚   â”‚
â”‚   â”‚   applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY),    â”‚   â”‚
â”‚   â”‚ });                                                                 â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ // Send subscription to backend                                     â”‚   â”‚
â”‚   â”‚ await api.post('/notifications/push-subscription', subscription);   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   2. BACKEND STORES SUBSCRIPTION:                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ // Stored in PushToken table                                        â”‚   â”‚
â”‚   â”‚ { userId, token, platform, createdAt }                              â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   3. SERVICE WORKER RECEIVES PUSH:                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ // public/sw.js                                                     â”‚   â”‚
â”‚   â”‚ self.addEventListener('push', (event) => {                          â”‚   â”‚
â”‚   â”‚   const data = event.data.json();                                   â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   event.waitUntil(                                                  â”‚   â”‚
â”‚   â”‚     self.registration.showNotification(data.title, {                â”‚   â”‚
â”‚   â”‚       body: data.body,                                              â”‚   â”‚
â”‚   â”‚       icon: data.icon,                                              â”‚   â”‚
â”‚   â”‚       badge: '/badge.png',                                          â”‚   â”‚
â”‚   â”‚       vibrate: [200, 100, 200],  // For emergencies                 â”‚   â”‚
â”‚   â”‚     })                                                              â”‚   â”‚
â”‚   â”‚   );                                                                â”‚   â”‚
â”‚   â”‚ });                                                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Frontend Architecture

### Next.js App Router Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND ARCHITECTURE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   app/                                                                      â”‚
â”‚   â”œâ”€â”€ layout.tsx              # Root layout with providers                  â”‚
â”‚   â”œâ”€â”€ page.tsx                # Landing page (/)                            â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â”€ (auth)/                 # Auth route group (public)                   â”‚
â”‚   â”‚   â”œâ”€â”€ layout.tsx          # Centered auth layout                        â”‚
â”‚   â”‚   â”œâ”€â”€ login/page.tsx      # /login                                      â”‚
â”‚   â”‚   â”œâ”€â”€ register/page.tsx   # /register                                   â”‚
â”‚   â”‚   â””â”€â”€ accept-invite/[token]/page.tsx  # /accept-invite/abc123           â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â””â”€â”€ (app)/                  # App route group (protected)                 â”‚
â”‚       â”œâ”€â”€ layout.tsx          # App shell with sidebar/nav                  â”‚
â”‚       â”œâ”€â”€ page.tsx            # /dashboard (home)                           â”‚
â”‚       â”œâ”€â”€ care/               # Care recipient routes                       â”‚
â”‚       â”‚   â””â”€â”€ [id]/           # /care/cr_abc123                             â”‚
â”‚       â”‚       â”œâ”€â”€ page.tsx    # Care recipient overview                     â”‚
â”‚       â”‚       â”œâ”€â”€ medications/page.tsx                                      â”‚
â”‚       â”‚       â”œâ”€â”€ calendar/page.tsx                                         â”‚
â”‚       â”‚       â””â”€â”€ ...                                                       â”‚
â”‚       â”œâ”€â”€ family/page.tsx     # /family                                     â”‚
â”‚       â””â”€â”€ settings/page.tsx   # /settings                                   â”‚
â”‚                                                                             â”‚
â”‚   LAYOUT HIERARCHY:                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ RootLayout (providers: React Query, Auth, Toast)                    â”‚   â”‚
â”‚   â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ AuthLayout (centered card)                                    â”‚   â”‚
â”‚   â”‚   â”‚     â””â”€â”€ Login / Register / Accept Invite                        â”‚   â”‚
â”‚   â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚   â””â”€â”€ AppLayout (sidebar + content)                                 â”‚   â”‚
â”‚   â”‚         â”œâ”€â”€ Dashboard                                               â”‚   â”‚
â”‚   â”‚         â”œâ”€â”€ Care Recipient Pages                                    â”‚   â”‚
â”‚   â”‚         â””â”€â”€ Settings                                                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. API Design

### RESTful Endpoints

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          API ENDPOINTS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   AUTH                                                                      â”‚
â”‚   â•â•â•â•                                                                      â”‚
â”‚   POST   /api/v1/auth/register                Create account                â”‚
â”‚   POST   /api/v1/auth/verify-email            Verify email                  â”‚
â”‚   POST   /api/v1/auth/login                   Login                         â”‚
â”‚   POST   /api/v1/auth/refresh                 Refresh tokens                â”‚
â”‚   POST   /api/v1/auth/logout                  Logout                        â”‚
â”‚   POST   /api/v1/auth/forgot-password         Request reset                 â”‚
â”‚   POST   /api/v1/auth/reset-password          Reset password                â”‚
â”‚   GET    /api/v1/auth/sessions                Get active sessions           â”‚
â”‚                                                                             â”‚
â”‚   USERS                                                                     â”‚
â”‚   â•â•â•â•â•                                                                     â”‚
â”‚   GET    /api/v1/users/me                     Get current user              â”‚
â”‚   PUT    /api/v1/users/me                     Update profile                â”‚
â”‚   GET    /api/v1/users/me/preferences         Get preferences               â”‚
â”‚   PUT    /api/v1/users/me/preferences         Update preferences            â”‚
â”‚                                                                             â”‚
â”‚   FAMILIES                                                                  â”‚
â”‚   â•â•â•â•â•â•â•â•                                                                  â”‚
â”‚   POST   /api/v1/families                     Create family                 â”‚
â”‚   GET    /api/v1/families                     List user's families          â”‚
â”‚   GET    /api/v1/families/:id                 Get family details            â”‚
â”‚   GET    /api/v1/families/:id/members         Get family members            â”‚
â”‚   POST   /api/v1/families/:id/invitations     Invite member                 â”‚
â”‚   POST   /api/v1/families/invitations/:token/accept  Accept invite          â”‚
â”‚   DELETE /api/v1/families/:id/members/:uid    Remove member                 â”‚
â”‚                                                                             â”‚
â”‚   CARE RECIPIENTS                                                           â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                           â”‚
â”‚   GET    /api/v1/families/:fid/care-recipients         List recipients      â”‚
â”‚   POST   /api/v1/families/:fid/care-recipients         Create recipient     â”‚
â”‚   GET    /api/v1/families/:fid/care-recipients/:id     Get details          â”‚
â”‚   PUT    /api/v1/families/:fid/care-recipients/:id     Update recipient     â”‚
â”‚   DELETE /api/v1/families/:fid/care-recipients/:id     Delete               â”‚
â”‚                                                                             â”‚
â”‚   MEDICATIONS                                                               â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•                                                               â”‚
â”‚   GET    /api/v1/care-recipients/:id/medications           List meds        â”‚
â”‚   POST   /api/v1/care-recipients/:id/medications           Add medication   â”‚
â”‚   GET    /api/v1/care-recipients/:id/medications/schedule/today             â”‚
â”‚   POST   /api/v1/medications/:id/log                       Log medication   â”‚
â”‚                                                                             â”‚
â”‚   APPOINTMENTS                                                              â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•                                                              â”‚
â”‚   GET    /api/v1/care-recipients/:id/appointments          List             â”‚
â”‚   POST   /api/v1/care-recipients/:id/appointments          Create           â”‚
â”‚   GET    /api/v1/care-recipients/:id/appointments/upcoming Upcoming         â”‚
â”‚   PATCH  /api/v1/care-recipients/:id/appointments/:id      Update           â”‚
â”‚                                                                             â”‚
â”‚   CAREGIVER SHIFTS                                                          â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                          â”‚
â”‚   GET    /api/v1/care-recipients/:id/shifts                List shifts      â”‚
â”‚   POST   /api/v1/care-recipients/:id/shifts                Create shift     â”‚
â”‚   POST   /api/v1/care-recipients/:id/shifts/:id/checkin    Check in         â”‚
â”‚   POST   /api/v1/care-recipients/:id/shifts/:id/checkout   Check out        â”‚
â”‚                                                                             â”‚
â”‚   EMERGENCY                                                                 â”‚
â”‚   â•â•â•â•â•â•â•â•â•                                                                 â”‚
â”‚   POST   /api/v1/families/:fid/emergency/alert             Trigger alert    â”‚
â”‚   GET    /api/v1/families/:fid/emergency/alerts            List alerts      â”‚
â”‚   POST   /api/v1/families/:fid/emergency/alerts/:id/resolve Resolve         â”‚
â”‚                                                                             â”‚
â”‚   NOTIFICATIONS                                                             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•                                                             â”‚
â”‚   GET    /api/v1/notifications                             List             â”‚
â”‚   PATCH  /api/v1/notifications/read/all                    Mark all read    â”‚
â”‚   POST   /api/v1/notifications/push-subscription           Subscribe push   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Security Implementation

### Security Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SECURITY LAYERS                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   1. AUTHENTICATION (httpOnly Cookies)                                      â”‚
â”‚      â€¢ Access tokens: httpOnly cookie + in-memory (15 min expiry)           â”‚
â”‚      â€¢ Refresh tokens: httpOnly cookie ONLY (7-30 day expiry)               â”‚
â”‚      â€¢ SameSite: strict (CSRF protection)                                   â”‚
â”‚      â€¢ Secure flag in production (HTTPS only)                               â”‚
â”‚      â€¢ Automatic token rotation on refresh                                  â”‚
â”‚      â€¢ Session tracking in database                                         â”‚
â”‚      â€¢ NO tokens in localStorage (XSS immune)                               â”‚
â”‚                                                                             â”‚
â”‚   2. AUTHORIZATION                                                          â”‚
â”‚      â€¢ Role-based access (ADMIN, CAREGIVER, VIEWER)                         â”‚
â”‚      â€¢ Family-scoped data access                                            â”‚
â”‚      â€¢ Resource ownership validation                                        â”‚
â”‚                                                                             â”‚
â”‚   3. INPUT VALIDATION                                                       â”‚
â”‚      â€¢ class-validator on all DTOs                                          â”‚
â”‚      â€¢ Parameterized queries (SQL injection prevention)                     â”‚
â”‚      â€¢ File type validation on uploads                                      â”‚
â”‚                                                                             â”‚
â”‚   4. RATE LIMITING                                                          â”‚
â”‚      â€¢ NestJS Throttler                                                     â”‚
â”‚      â€¢ Stricter limits on auth endpoints                                    â”‚
â”‚                                                                             â”‚
â”‚   5. TRANSPORT SECURITY                                                     â”‚
â”‚      â€¢ HTTPS only in production                                             â”‚
â”‚      â€¢ Secure cookies                                                       â”‚
â”‚      â€¢ CORS configured for specific origins                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Authentication Flow (httpOnly Cookies)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AUTHENTICATION FLOW                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   1. LOGIN                                                                  â”‚
â”‚      Frontend: POST /auth/login { email, password }                         â”‚
â”‚      Backend:  â”œâ”€ Validate credentials                                      â”‚
â”‚                â”œâ”€ Generate access + refresh tokens                          â”‚
â”‚                â”œâ”€ Set httpOnly cookies (access_token, refresh_token)        â”‚
â”‚                â””â”€ Return: { user, accessToken }                             â”‚
â”‚      Frontend: Store access token in memory (React state)                   â”‚
â”‚                                                                             â”‚
â”‚   2. API REQUEST                                                            â”‚
â”‚      Frontend: GET /api/v1/care-recipients                                  â”‚
â”‚                â”œâ”€ Authorization: Bearer {accessToken}                       â”‚
â”‚                â””â”€ credentials: 'include' (sends cookies)                    â”‚
â”‚      Backend:  Validate access token from header                            â”‚
â”‚                                                                             â”‚
â”‚   3. TOKEN EXPIRY (Access token expires after 15 min)                       â”‚
â”‚      Frontend: API returns 401 Unauthorized                                 â”‚
â”‚                â”œâ”€ POST /auth/refresh (no body, cookies sent automatically)  â”‚
â”‚                â””â”€ credentials: 'include'                                    â”‚
â”‚      Backend:  â”œâ”€ Read refresh token from httpOnly cookie                   â”‚
â”‚                â”œâ”€ Validate refresh token                                    â”‚
â”‚                â”œâ”€ Generate NEW access + refresh tokens                      â”‚
â”‚                â”œâ”€ Update httpOnly cookies (rotation)                        â”‚
â”‚                â””â”€ Return: { accessToken }                                   â”‚
â”‚      Frontend: â”œâ”€ Update access token in memory                             â”‚
â”‚                â””â”€ Retry original request                                    â”‚
â”‚                                                                             â”‚
â”‚   4. PAGE REFRESH                                                           â”‚
â”‚      Frontend: App loads â†’ fetchUser() called                               â”‚
â”‚                â”œâ”€ POST /auth/refresh (gets new access token from cookie)    â”‚
â”‚                â”œâ”€ GET /auth/me (fetch user profile)                         â”‚
â”‚                â””â”€ User stays logged in!                                     â”‚
â”‚                                                                             â”‚
â”‚   5. LOGOUT                                                                 â”‚
â”‚      Frontend: POST /auth/logout                                            â”‚
â”‚      Backend:  â”œâ”€ Invalidate session in database                            â”‚
â”‚                â”œâ”€ Clear httpOnly cookies                                    â”‚
â”‚                â””â”€ Return: { message: 'Logged out' }                         â”‚
â”‚      Frontend: Clear access token from memory                               â”‚
â”‚                                                                             â”‚
â”‚   SECURITY BENEFITS:                                                        â”‚
â”‚   âœ… Refresh token NEVER exposed to JavaScript (XSS immune)                 â”‚
â”‚   âœ… Access token in memory only (lost on tab close)                        â”‚
â”‚   âœ… SameSite: strict prevents CSRF attacks                                 â”‚
â”‚   âœ… Automatic token rotation prevents token reuse                          â”‚
â”‚   âœ… Cookies work seamlessly across requests                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. Running the Project

### Prerequisites

- Node.js 18+
- pnpm 9+
- Docker & Docker Compose

### Quick Start

```powershell
# 1. Clone the repository
git clone https://github.com/yourorg/carecircle.git
cd carecircle

# 2. Install dependencies
pnpm install

# 3. Switch to local profile (generates .env files)
.\scripts\use-local.ps1

# 4. Start Docker services (PostgreSQL, Redis, RabbitMQ)
docker compose up -d

# 5. Setup database (first time only)
pnpm --filter @carecircle/database generate
pnpm --filter @carecircle/database push

# 6. Start development servers
pnpm dev:api      # Terminal 1 - API
pnpm dev:web      # Terminal 2 - Web
pnpm dev:workers  # Terminal 3 - Workers

# Or start all at once:
pnpm dev
```

### Environment Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ENVIRONMENT CONFIGURATION                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   CareCircle uses a profile-based environment system:                       â”‚
â”‚                                                                             â”‚
â”‚   env/                                                                      â”‚
â”‚   â”œâ”€â”€ base.env          # Shared config (JWT, Cloudinary, Mailtrap, etc.)   â”‚
â”‚   â”œâ”€â”€ local.env         # Local Docker services (postgres, redis, rabbitmq) â”‚
â”‚   â””â”€â”€ cloud.env         # Cloud services (for production deployment)        â”‚
â”‚                                                                             â”‚
â”‚   SWITCHING PROFILES:                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ # Switch to local development                                       â”‚   â”‚
â”‚   â”‚ .\scripts\use-local.ps1                                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ # Switch to cloud/production                                        â”‚   â”‚
â”‚   â”‚ .\scripts\use-cloud.ps1                                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ # These scripts merge base.env + profile.env â†’ .env                 â”‚   â”‚
â”‚   â”‚ # and copy to apps/api/.env, apps/web/.env, etc.                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   LOCAL PROFILE INCLUDES:                                                   â”‚
â”‚   â€¢ PostgreSQL: localhost:5432 (postgres/1234)                              â”‚
â”‚   â€¢ Redis: localhost:6379                                                   â”‚
â”‚   â€¢ RabbitMQ: localhost:5672 (guest/guest)                                  â”‚
â”‚                                                                             â”‚
â”‚   THIRD-PARTY SERVICES (always):                                            â”‚
â”‚   â€¢ Email: Mailtrap (sandbox.smtp.mailtrap.io)                              â”‚
â”‚   â€¢ Storage: Cloudinary                                                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### What Starts

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¡ CareCircle Development Environment                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  APPLICATIONS:                                                              â”‚
â”‚  â”œâ”€ ğŸŒ Web App      â†’ http://localhost:3000                                 â”‚
â”‚  â”œâ”€ ğŸ”Œ API Server   â†’ http://localhost:3001/api/v1                          â”‚
â”‚  â”œâ”€ ğŸ“š Swagger Docs â†’ http://localhost:3001/api                             â”‚
â”‚  â””â”€ âš™ï¸  Workers      â†’ Background job processing                             â”‚
â”‚                                                                             â”‚
â”‚  INFRASTRUCTURE (Docker):                                                   â”‚
â”‚  â”œâ”€ ğŸ˜ PostgreSQL   â†’ localhost:5432                                        â”‚
â”‚  â”œâ”€ ğŸ”´ Redis        â†’ localhost:6379                                        â”‚
â”‚  â””â”€ ğŸ° RabbitMQ     â†’ localhost:15672 (Management UI, guest/guest)          â”‚
â”‚                                                                             â”‚
â”‚  THIRD-PARTY SERVICES:                                                      â”‚
â”‚  â”œâ”€ ğŸ“§ Email        â†’ Mailtrap (view emails at mailtrap.io)                 â”‚
â”‚  â””â”€ ğŸ“¦ Storage      â†’ Cloudinary                                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Useful Commands

```bash
# Run specific app
pnpm dev:api                              # Start API only
pnpm dev:web                              # Start Web only
pnpm dev:workers                          # Start Workers only

# Database commands (Prisma)
pnpm --filter @carecircle/database generate    # Generate Prisma client
pnpm --filter @carecircle/database push        # Push schema to database
pnpm --filter @carecircle/database studio      # Open Prisma Studio GUI
pnpm --filter @carecircle/database migrate dev # Create migration

# Build
pnpm build                                # Build all apps

# Docker
docker compose up -d                      # Start services
docker compose down                       # Stop services
docker compose logs -f                    # View logs
docker compose ps                         # Check status
```

---

## 11. Deployment Guide

### Docker Production Setup

**Production-ready Docker Compose configuration for scalable deployment**

See [DOCKER_DEPLOYMENT.md](./DOCKER_DEPLOYMENT.md) for complete deployment guide.

#### Quick Start

```powershell
# 1. Setup environment
.\scripts\use-cloud.ps1
# Edit env/cloud.env with your production values

# 2. Build all images (Windows)
.\scripts\deploy-prod.ps1 -Build

# 3. Start all services
.\scripts\deploy-prod.ps1 -Up

# 4. Verify deployment
docker-compose -f docker-compose.prod.yml ps
```

#### Production Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PRODUCTION DEPLOYMENT ARCHITECTURE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Nginx (Load Balancer)                                                     â”‚
â”‚   â”œâ”€ Rate Limiting: 100 req/s (API), 200 req/s (Web)                       â”‚
â”‚   â”œâ”€ SSL/TLS Termination                                                    â”‚
â”‚   â””â”€ Static Asset Caching (1 year immutable)                               â”‚
â”‚                                                                             â”‚
â”‚   API Service (4 replicas)                                                  â”‚
â”‚   â”œâ”€ 2GB memory per instance                                               â”‚
â”‚   â”œâ”€ Health checks enabled                                                  â”‚
â”‚   â””â”€ Auto-restart on failure                                                â”‚
â”‚                                                                             â”‚
â”‚   Web Service (3 replicas)                                                  â”‚
â”‚   â”œâ”€ 1GB memory per instance                                               â”‚
â”‚   â”œâ”€ Next.js standalone mode                                               â”‚
â”‚   â””â”€ PWA with offline support                                               â”‚
â”‚                                                                             â”‚
â”‚   Workers Service (3 replicas)                                              â”‚
â”‚   â”œâ”€ 512MB memory per instance                                             â”‚
â”‚   â””â”€ Background job processing                                              â”‚
â”‚                                                                             â”‚
â”‚   PostgreSQL                                                                â”‚
â”‚   â”œâ”€ 4GB memory allocation                                                 â”‚
â”‚   â””â”€ 200 max connections                                                    â”‚
â”‚                                                                             â”‚
â”‚   Redis                                                                      â”‚
â”‚   â”œâ”€ 2GB memory with LRU eviction                                          â”‚
â”‚   â””â”€ AOF persistence enabled                                                â”‚
â”‚                                                                             â”‚
â”‚   RabbitMQ                                                                   â”‚
â”‚   â”œâ”€ 2GB memory allocation                                                 â”‚
â”‚   â””â”€ Event-driven messaging                                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 12. Implemented Features Status

### âœ… Core Features (Completed & Tested)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLETED FEATURES                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ” AUTHENTICATION & AUTHORIZATION                                         â”‚
â”‚   âœ… User registration with email verification                              â”‚
â”‚   âœ… Login with JWT access/refresh tokens                                   â”‚
â”‚   âœ… Token refresh mechanism                                                â”‚
â”‚   âœ… Password reset flow                                                    â”‚
â”‚   âœ… Role-based access control (ADMIN, CAREGIVER, VIEWER)                   â”‚
â”‚   âœ… Session management & tracking                                          â”‚
â”‚   âœ… HTTP-only cookies for security                                         â”‚
â”‚                                                                             â”‚
â”‚   ğŸ‘¥ FAMILY MANAGEMENT                                                      â”‚
â”‚   âœ… Create and manage families                                             â”‚
â”‚   âœ… Invite family members via email                                        â”‚
â”‚   âœ… Accept/decline invitations                                             â”‚
â”‚   âœ… Manage family member roles                                             â”‚
â”‚   âœ… Remove family members                                                  â”‚
â”‚   âœ… Family-scoped data isolation                                           â”‚
â”‚                                                                             â”‚
â”‚   ğŸ§‘â€âš•ï¸ CARE RECIPIENT MANAGEMENT                                             â”‚
â”‚   âœ… Create and manage care recipients                                      â”‚
â”‚   âœ… Store medical information (allergies, conditions, blood type)          â”‚
â”‚   âœ… Add doctors and emergency contacts                                     â”‚
â”‚   âœ… Store insurance information                                            â”‚
â”‚                                                                             â”‚
â”‚   ğŸ’Š MEDICATION TRACKING                                                    â”‚
â”‚   âœ… Add medications with schedules                                         â”‚
â”‚   âœ… Daily medication schedule view                                         â”‚
â”‚   âœ… Log medications (given/skipped/missed)                                 â”‚
â”‚   âœ… Supply tracking & refill alerts                                        â”‚
â”‚   âœ… Medication history                                                     â”‚
â”‚                                                                             â”‚
â”‚   ğŸ“… APPOINTMENTS & CALENDAR                                                â”‚
â”‚   âœ… Create one-time appointments                                           â”‚
â”‚   âœ… Create recurring appointments                                          â”‚
â”‚   âœ… Appointment reminders                                                  â”‚
â”‚   âœ… Transport assignment                                                   â”‚
â”‚                                                                             â”‚
â”‚   ğŸ“„ DOCUMENT MANAGEMENT                                                    â”‚
â”‚   âœ… Upload documents to Cloudinary                                         â”‚
â”‚   âœ… Secure document storage                                                â”‚
â”‚   âœ… Document expiration tracking                                           â”‚
â”‚                                                                             â”‚
â”‚   ğŸš¨ EMERGENCY ALERTS                                                       â”‚
â”‚   âœ… Trigger emergency alerts                                               â”‚
â”‚   âœ… Alert types (FALL, MEDICAL, HOSPITALIZATION, MISSING)                  â”‚
â”‚   âœ… Family notification system                                             â”‚
â”‚   âœ… Resolve and acknowledge alerts                                         â”‚
â”‚                                                                             â”‚
â”‚   ğŸ‘¨â€âš•ï¸ CAREGIVER SCHEDULING                                                  â”‚
â”‚   âœ… Create shifts for caregivers                                           â”‚
â”‚   âœ… Shift overlap validation                                               â”‚
â”‚   âœ… Check-in/check-out functionality                                       â”‚
â”‚   âœ… Handoff notes for shift transitions                                    â”‚
â”‚                                                                             â”‚
â”‚   ğŸ”” REAL-TIME & NOTIFICATIONS                                              â”‚
â”‚   âœ… Real-time updates via Socket.io                                        â”‚
â”‚   âœ… WebSocket gateway with family rooms                                    â”‚
â”‚   âœ… Push notifications (WebPush/VAPID)                                     â”‚
â”‚   âœ… Emergency alerts notify everyone instantly                             â”‚
â”‚   âœ… RabbitMQ event consumers                                               â”‚
â”‚                                                                             â”‚
â”‚   ğŸ“± MOBILE PWA                                                             â”‚
â”‚   âœ… App installable on phone                                               â”‚
â”‚   âœ… Works offline (service worker)                                         â”‚
â”‚   âœ… Push notifications on mobile                                           â”‚
â”‚   âœ… Responsive design                                                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ‰ Production Ready

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PRODUCTION READY - ALL FEATURES COMPLETE                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   âœ… ALL BACKEND SYSTEMS OPERATIONAL                                        â”‚
â”‚   âœ… ALL FRONTEND FEATURES IMPLEMENTED                                      â”‚
â”‚   âœ… REAL-TIME WEBSOCKET CONNECTED                                          â”‚
â”‚   âœ… PUSH NOTIFICATIONS CONFIGURED                                          â”‚
â”‚   âœ… EVENT CONSUMERS RUNNING                                                â”‚
â”‚   âœ… RABBITMQ QUEUES ACTIVE                                                 â”‚
â”‚   âœ… MOBILE PWA CONFIGURED & INSTALLABLE                                    â”‚
â”‚   âœ… OFFLINE MODE WITH SERVICE WORKER                                       â”‚
â”‚                                                                             â”‚
â”‚   ğŸš€ Application URLs:                                                     â”‚
â”‚      - Web: http://localhost:3000                                          â”‚
â”‚      - API: http://localhost:3001/api/v1                                   â”‚
â”‚      - Swagger: http://localhost:3001/api                                  â”‚
â”‚      - RabbitMQ: http://localhost:15672 (guest/guest)                      â”‚
â”‚                                                                             â”‚
â”‚   ğŸ“± Mobile PWA:                                                            â”‚
â”‚      - Visit http://localhost:3000 on mobile                               â”‚
â”‚      - Click "Add to Home Screen"                                          â”‚
â”‚      - Use as native app with offline support                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Next Steps

1. **Start here**: [Running the Project](#10-running-the-project)
2. **Understand auth**: [AUTHENTICATION.md](./AUTHENTICATION.md)
3. **Free services setup**: [FREE_SERVICES_SETUP.md](../getting-started/FREE_SERVICES_SETUP.md)
4. **Master production**: [engineering-mastery/](../engineering-mastery/)

---

_CareCircle: Caregiving, coordinated. ğŸ¡_
