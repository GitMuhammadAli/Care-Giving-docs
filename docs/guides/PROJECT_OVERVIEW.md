# ğŸ“š CareCircle Complete Learning Guide

> Everything you need to understand, run, and extend the CareCircle caregiving coordination platform.

---

## Table of Contents

1. [Project Overview](#1-project-overview)
2. [Architecture Deep Dive](#2-architecture-deep-dive)
3. [Monorepo Structure](#3-monorepo-structure)
4. [Database Design](#4-database-design)
5. [Event-Driven Architecture](#5-event-driven-architecture)
6. [Real-Time Features](#6-real-time-features)
7. [Frontend Architecture](#7-frontend-architecture)
8. [API Design](#8-api-design)
9. [Security Implementation](#9-security-implementation)
10. [Running the Project](#10-running-the-project)
11. [Deployment Guide](#11-deployment-guide)

---

## 1. Project Overview

### What is CareCircle?

CareCircle is a **family caregiving coordination platform** that helps families manage care for elderly or ill loved ones.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         THE PROBLEM                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   "Dad fell last Tuesday and was in ER. My sister didn't know for           â”‚
â”‚    6 hours because we're in different time zones. His medication            â”‚
â”‚    list was in Mom's email, his doctor's contact was in my phone,           â”‚
â”‚    and the insurance card was at his house."                                â”‚
â”‚                                                                             â”‚
â”‚   Common Pain Points:                                                       â”‚
â”‚   â€¢ Family members in different states/time zones                           â”‚
â”‚   â€¢ 5 doctors, 3 medications, weekly PT - no central tracking               â”‚
â”‚   â€¢ Shared Google Doc is chaos                                              â”‚
â”‚   â€¢ Missed appointments, double-booked caregivers                           â”‚
â”‚   â€¢ Medication errors                                                       â”‚
â”‚   â€¢ Emergency info scattered everywhere                                     â”‚
â”‚   â€¢ 6-hour delay in critical communication                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         THE SOLUTION: CARECIRCLE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                          â”‚    CareCircle     â”‚                              â”‚
â”‚                          â”‚  Central Hub for  â”‚                              â”‚
â”‚                          â”‚ Family Caregivers â”‚                              â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                    â”‚                                        â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚     â–¼              â–¼              â–¼              â–¼              â–¼          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ Meds   â”‚  â”‚  Calendar â”‚  â”‚ Emergency â”‚  â”‚ Family  â”‚  â”‚ Documents â”‚       â”‚
â”‚ â”‚Trackingâ”‚  â”‚Appointmentsâ”‚  â”‚  Alerts  â”‚  â”‚  Team   â”‚  â”‚   Vault   â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â”‚   âœ… One place for ALL care information                                     â”‚
â”‚   âœ… Real-time updates to all family members                                â”‚
â”‚   âœ… Emergency alerts in seconds, not hours                                 â”‚
â”‚   âœ… Medication logging & reminders                                         â”‚
â”‚   âœ… Caregiver shift coordination                                           â”‚
â”‚   âœ… Health timeline for doctor visits                                      â”‚
â”‚   âœ… Works offline (emergency info cached)                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tech Stack

| Layer | Technology | Why |
|-------|------------|-----|
| **Frontend** | Next.js 14 (App Router) | Server components, great DX, PWA support |
| **Backend** | NestJS | Enterprise-grade, TypeScript, modular |
| **Database** | PostgreSQL | Relational data, ACID, JSON support |
| **Cache/Queue** | Redis + BullMQ | Fast cache, reliable job processing |
| **Message Broker** | RabbitMQ | Event-driven architecture, decoupling |
| **Real-time** | Socket.io | WebSocket support with fallbacks |
| **Storage** | Cloudinary/S3 | Document vault, image storage |
| **Auth** | JWT + HTTP-only cookies | Secure, stateless auth |

---

## 2. Architecture Deep Dive

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HIGH-LEVEL ARCHITECTURE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                          â”‚   LOAD BALANCER  â”‚                               â”‚
â”‚                          â”‚    (Nginx/ALB)   â”‚                               â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                   â”‚                                         â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚           â”‚                       â”‚                       â”‚                 â”‚
â”‚           â–¼                       â–¼                       â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚   Next.js     â”‚       â”‚    NestJS     â”‚       â”‚    NestJS     â”‚        â”‚
â”‚   â”‚   Frontend    â”‚       â”‚   API Server  â”‚       â”‚   API Server  â”‚        â”‚
â”‚   â”‚   (Node.js)   â”‚       â”‚   Instance 1  â”‚       â”‚   Instance 2  â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚           â”‚                       â”‚                       â”‚                 â”‚
â”‚           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                 â”‚
â”‚           â”‚              â”‚                 â”‚              â”‚                 â”‚
â”‚           â–¼              â–¼                 â–¼              â–¼                 â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚       â”‚                     Redis Cluster                        â”‚          â”‚
â”‚       â”‚  â€¢ Session Cache    â€¢ Rate Limiting    â€¢ Pub/Sub        â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                   â”‚                                         â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚           â”‚                       â”‚                       â”‚                 â”‚
â”‚           â–¼                       â–¼                       â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚  PostgreSQL   â”‚       â”‚   RabbitMQ    â”‚       â”‚    BullMQ     â”‚        â”‚
â”‚   â”‚   Primary     â”‚       â”‚   Exchange    â”‚       â”‚    Worker     â”‚        â”‚
â”‚   â”‚   + Replicas  â”‚       â”‚   + Queues    â”‚       â”‚   Processes   â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TYPICAL REQUEST FLOW                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   User clicks "Log Medication"                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  1. FRONTEND (Next.js)                                               â”‚  â”‚
â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚     â”‚ const { mutate } = useMutation({                             â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   mutationFn: () => api.post('/medications/123/log', {       â”‚ â”‚  â”‚
â”‚   â”‚     â”‚     status: 'GIVEN',                                         â”‚ â”‚  â”‚
â”‚   â”‚     â”‚     notes: 'Took with breakfast'                             â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   }),                                                        â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   onMutate: () => updateCacheOptimistically(),               â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ });                                                          â”‚ â”‚  â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚                              â”‚                                       â”‚  â”‚
â”‚   â”‚                              â–¼                                       â”‚  â”‚
â”‚   â”‚  2. API SERVER (NestJS)                                              â”‚  â”‚
â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚     â”‚ â€¢ JwtAuthGuard validates access token                        â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â€¢ RolesGuard checks user has CAREGIVER or ADMIN role         â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â€¢ ValidationPipe validates request body                      â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â€¢ MedicationsController.log() called                         â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â€¢ MedicationsService.log() creates log entry                 â”‚ â”‚  â”‚
â”‚   â”‚     â”‚                                                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ await this.dataSource.transaction(async (em) => {            â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   const log = em.create(MedicationLog, { ... });             â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   await em.save(log);                                        â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ });                                                          â”‚ â”‚  â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚                              â”‚                                       â”‚  â”‚
â”‚   â”‚                              â–¼                                       â”‚  â”‚
â”‚   â”‚  3. EVENT PUBLISHING                                                 â”‚  â”‚
â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚     â”‚ await this.eventPublisher.publish(                           â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   'medication.logged',                                       â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   {                                                          â”‚ â”‚  â”‚
â”‚   â”‚     â”‚     medicationId, careRecipientId, status,                   â”‚ â”‚  â”‚
â”‚   â”‚     â”‚     loggedById, loggedByName                                 â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   },                                                         â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   `medication.${status.toLowerCase()}.${careRecipientId}`,   â”‚ â”‚  â”‚
â”‚   â”‚     â”‚   '/api/v1/medications/123/log'                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ );                                                           â”‚ â”‚  â”‚
â”‚   â”‚     â”‚                                                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ Saved to outbox table (for reliability)                    â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ Immediately attempted to RabbitMQ                          â”‚ â”‚  â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚                              â”‚                                       â”‚  â”‚
â”‚   â”‚                              â–¼                                       â”‚  â”‚
â”‚   â”‚  4. EVENT CONSUMERS                                                  â”‚  â”‚
â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚     â”‚ WEBSOCKET CONSUMER:                                          â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ Sends to family members via Socket.io                      â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ UI updates in real-time                                    â”‚ â”‚  â”‚
â”‚   â”‚     â”‚                                                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ NOTIFICATION CONSUMER:                                       â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ Sends push notifications to family phones                  â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ "Sarah gave Dad his Metformin"                             â”‚ â”‚  â”‚
â”‚   â”‚     â”‚                                                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ AUDIT CONSUMER:                                              â”‚ â”‚  â”‚
â”‚   â”‚     â”‚ â†’ Logs event for compliance                                  â”‚ â”‚  â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Monorepo Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MONOREPO STRUCTURE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   carecircle/                                                               â”‚
â”‚   â”œâ”€â”€ apps/                          # Applications                         â”‚
â”‚   â”‚   â”œâ”€â”€ api/                       # NestJS Backend API                   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ src/                                                          â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth/             # Authentication module                 â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user/             # User management                       â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ care-recipients/  # Care recipient CRUD                   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ medications/      # Medication tracking                   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ appointments/     # Calendar & appointments               â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ documents/        # Document vault                        â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ emergency/        # Emergency alerts                      â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ timeline/         # Health timeline                       â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ caregivers/       # Shift management                      â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ families/         # Family & invites                      â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ notifications/    # Push notifications                    â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ gateway/          # WebSocket gateway                     â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ events/           # Event-driven architecture             â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ publishers/   # Event publishers                      â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ consumers/    # Event consumers                       â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ outbox/       # Outbox pattern                        â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ database/         # TypeORM config & migrations           â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ config/           # App configuration                     â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ system/           # Shared utilities                      â”‚
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ module/       # Mail, file upload, etc.               â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ package.json                                                  â”‚
â”‚   â”‚   â”‚   â””â”€â”€ nest-cli.json                                                 â”‚
â”‚   â”‚   â”‚                                                                     â”‚
â”‚   â”‚   â”œâ”€â”€ web/                       # Next.js Frontend                     â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ src/                                                          â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ app/              # App Router pages                      â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/       # Auth pages (login, register)          â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ (app)/        # Protected app pages                   â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx    # Root layout                           â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ components/       # React components                      â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ui/           # Base UI (Button, Input, etc.)         â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ care/         # Domain components                     â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ forms/        # Form components                       â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout/       # Layout components                     â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/            # React hooks                           â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ lib/              # Utils & API client                    â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ styles/           # Global CSS & Tailwind                 â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ public/               # Static assets                         â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sw.js             # Service worker                        â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ manifest.json     # PWA manifest                          â”‚
â”‚   â”‚   â”‚   â””â”€â”€ package.json                                                  â”‚
â”‚   â”‚   â”‚                                                                     â”‚
â”‚   â”‚   â””â”€â”€ workers/                   # Background Workers                   â”‚
â”‚   â”‚       â”œâ”€â”€ src/                                                          â”‚
â”‚   â”‚       â”‚   â”œâ”€â”€ processors/       # Job processors                        â”‚
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ reminder.processor.ts                                 â”‚
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ email.processor.ts                                    â”‚
â”‚   â”‚       â”‚   â””â”€â”€ main.ts                                                   â”‚
â”‚   â”‚       â””â”€â”€ package.json                                                  â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â”€ packages/                      # Shared Packages                      â”‚
â”‚   â”‚   â””â”€â”€ shared/                                                           â”‚
â”‚   â”‚       â”œâ”€â”€ src/                                                          â”‚
â”‚   â”‚       â”‚   â”œâ”€â”€ types/            # Shared TypeScript types               â”‚
â”‚   â”‚       â”‚   â”œâ”€â”€ constants/        # Shared constants                      â”‚
â”‚   â”‚       â”‚   â””â”€â”€ utils/            # Shared utilities                      â”‚
â”‚   â”‚       â””â”€â”€ package.json                                                  â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â”€ docs/                          # Documentation                        â”‚
â”‚   â”‚   â”œâ”€â”€ guides/                   # Learning guides (you are here!)       â”‚
â”‚   â”‚   â””â”€â”€ engineering-mastery/      # Production engineering docs           â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â”€ docker-compose.yml             # Local development services           â”‚
â”‚   â”œâ”€â”€ pnpm-workspace.yaml            # pnpm workspace config                â”‚
â”‚   â”œâ”€â”€ package.json                   # Root package.json                    â”‚
â”‚   â””â”€â”€ SETUP.md                       # Getting started guide                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why Monorepo?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MONOREPO BENEFITS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   1. SHARED CODE                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ // packages/shared/src/types/medication.ts                          â”‚   â”‚
â”‚   â”‚ export interface Medication {                                       â”‚   â”‚
â”‚   â”‚   id: string;                                                       â”‚   â”‚
â”‚   â”‚   name: string;                                                     â”‚   â”‚
â”‚   â”‚   dosage: string;                                                   â”‚   â”‚
â”‚   â”‚   frequency: string;                                                â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ // Used in BOTH frontend and backend!                               â”‚   â”‚
â”‚   â”‚ // apps/api/src/medications/medications.service.ts                  â”‚   â”‚
â”‚   â”‚ import { Medication } from '@carecircle/shared';                    â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ // apps/web/src/lib/api/medications.ts                              â”‚   â”‚
â”‚   â”‚ import { Medication } from '@carecircle/shared';                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   2. ATOMIC CHANGES                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ One commit can update:                                              â”‚   â”‚
â”‚   â”‚ â€¢ API endpoint                                                      â”‚   â”‚
â”‚   â”‚ â€¢ Frontend component                                                â”‚   â”‚
â”‚   â”‚ â€¢ Shared types                                                      â”‚   â”‚
â”‚   â”‚ â€¢ Documentation                                                     â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ No more "update API in PR #1, update frontend in PR #2"             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   3. SIMPLIFIED TOOLING                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ # Run EVERYTHING with one command                                   â”‚   â”‚
â”‚   â”‚ $ pnpm dev                                                          â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ # Build ALL apps                                                    â”‚   â”‚
â”‚   â”‚ $ pnpm build                                                        â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ # Test ALL packages                                                 â”‚   â”‚
â”‚   â”‚ $ pnpm test                                                         â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ # Filter to specific app                                            â”‚   â”‚
â”‚   â”‚ $ pnpm --filter @carecircle/api dev                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Database Design

### Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE SCHEMA (Simplified)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚    User     â”‚â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”‚  FamilyMember   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    Family    â”‚   â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚   â”‚ id (PK)     â”‚       â”‚  â”‚ userId (FK)     â”‚          â”‚ id (PK)      â”‚   â”‚
â”‚   â”‚ email       â”‚       â”‚  â”‚ familyId (FK)   â”‚          â”‚ name         â”‚   â”‚
â”‚   â”‚ passwordHashâ”‚       â”‚  â”‚ role            â”‚          â”‚ createdAt    â”‚   â”‚
â”‚   â”‚ fullName    â”‚       â”‚  â”‚ addedAt         â”‚          â”‚ updatedAt    â”‚   â”‚
â”‚   â”‚ phone       â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”‚ emailVerifiedâ”‚      â”‚                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚                                      â”‚           â”‚
â”‚          â”‚              â”‚                                      â”‚           â”‚
â”‚          â–¼              â”‚                                      â–¼           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚   Session   â”‚       â”‚                              â”‚CareRecipient â”‚    â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚
â”‚   â”‚ id (PK)     â”‚       â”‚                              â”‚ id (PK)      â”‚    â”‚
â”‚   â”‚ userId (FK) â”‚       â”‚                              â”‚ familyId (FK)â”‚    â”‚
â”‚   â”‚ tokenHash   â”‚       â”‚                              â”‚ firstName    â”‚    â”‚
â”‚   â”‚ expiresAt   â”‚       â”‚                              â”‚ lastName     â”‚    â”‚
â”‚   â”‚ revokedAt   â”‚       â”‚                              â”‚ dateOfBirth  â”‚    â”‚
â”‚   â”‚ ipAddress   â”‚       â”‚                              â”‚ bloodType    â”‚    â”‚
â”‚   â”‚ userAgent   â”‚       â”‚                              â”‚ allergies    â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                              â”‚ conditions   â”‚    â”‚
â”‚                         â”‚                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                     â”‚            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                     â”‚                                     â”‚            â”‚
â”‚   â–¼                     â–¼                                     â–¼            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ Medication   â”‚  â”‚ Appointment  â”‚  â”‚TimelineEntry â”‚  â”‚   Document   â”‚     â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚
â”‚ â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚     â”‚
â”‚ â”‚ recipientId  â”‚  â”‚ recipientId  â”‚  â”‚ recipientId  â”‚  â”‚ recipientId  â”‚     â”‚
â”‚ â”‚ name         â”‚  â”‚ title        â”‚  â”‚ type         â”‚  â”‚ type         â”‚     â”‚
â”‚ â”‚ dosage       â”‚  â”‚ date         â”‚  â”‚ content      â”‚  â”‚ fileName     â”‚     â”‚
â”‚ â”‚ frequency    â”‚  â”‚ location     â”‚  â”‚ authorId     â”‚  â”‚ fileUrl      â”‚     â”‚
â”‚ â”‚ times[]      â”‚  â”‚ assignedTo   â”‚  â”‚ createdAt    â”‚  â”‚ uploadedById â”‚     â”‚
â”‚ â”‚ instructions â”‚  â”‚ notes        â”‚  â”‚ vitals (JSON)â”‚  â”‚ category     â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚MedicationLog â”‚  â”‚EmergencyAlertâ”‚  â”‚ CareShift    â”‚  â”‚ FamilyInvite â”‚     â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚
â”‚ â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚     â”‚
â”‚ â”‚ medicationId â”‚  â”‚ recipientId  â”‚  â”‚ recipientId  â”‚  â”‚ familyId     â”‚     â”‚
â”‚ â”‚ status       â”‚  â”‚ type         â”‚  â”‚ caregiverId  â”‚  â”‚ email        â”‚     â”‚
â”‚ â”‚ scheduledTimeâ”‚  â”‚ triggeredBy  â”‚  â”‚ startTime    â”‚  â”‚ role         â”‚     â”‚
â”‚ â”‚ loggedAt     â”‚  â”‚ resolvedAt   â”‚  â”‚ endTime      â”‚  â”‚ token        â”‚     â”‚
â”‚ â”‚ loggedById   â”‚  â”‚ description  â”‚  â”‚ checkedInAt  â”‚  â”‚ expiresAt    â”‚     â”‚
â”‚ â”‚ notes        â”‚  â”‚              â”‚  â”‚ checkedOutAt â”‚  â”‚ acceptedAt   â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ notes        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚ â”‚ EventOutbox  â”‚  â”‚PushSubscript.â”‚                                         â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                         â”‚
â”‚ â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚                                         â”‚
â”‚ â”‚ eventType    â”‚  â”‚ userId       â”‚                                         â”‚
â”‚ â”‚ payload      â”‚  â”‚ endpoint     â”‚                                         â”‚
â”‚ â”‚ routingKey   â”‚  â”‚ keys         â”‚                                         â”‚
â”‚ â”‚ processed    â”‚  â”‚ createdAt    â”‚                                         â”‚
â”‚ â”‚ retries      â”‚  â”‚              â”‚                                         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Multi-Tenancy (Family-Based)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MULTI-TENANCY MODEL                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   CareCircle uses FAMILY-BASED multi-tenancy:                               â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Family: "Thompson Family"                                         â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Members:                                                      â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Sarah Thompson (ADMIN)                                    â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Mike Thompson (CAREGIVER)                                 â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ Jennifer Thompson (VIEWER)                                â”‚   â”‚
â”‚   â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Care Recipients:                                              â”‚   â”‚
â”‚   â”‚       â””â”€â”€ Margaret "Grandma Maggie" Thompson                        â”‚   â”‚
â”‚   â”‚           â”œâ”€â”€ Medications                                           â”‚   â”‚
â”‚   â”‚           â”œâ”€â”€ Appointments                                          â”‚   â”‚
â”‚   â”‚           â”œâ”€â”€ Documents                                             â”‚   â”‚
â”‚   â”‚           â”œâ”€â”€ Timeline                                              â”‚   â”‚
â”‚   â”‚           â””â”€â”€ Emergency Info                                        â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   DATA ISOLATION:                                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚                                                                             â”‚
â”‚   // Every query is scoped to the user's family!                            â”‚
â”‚                                                                             â”‚
â”‚   // WRONG (security risk!)                                                 â”‚
â”‚   const meds = await medicationRepo.find({                                  â”‚
â”‚     where: { careRecipientId }  // Could access ANY family's data!          â”‚
â”‚   });                                                                       â”‚
â”‚                                                                             â”‚
â”‚   // RIGHT (family-scoped)                                                  â”‚
â”‚   const meds = await medicationRepo.find({                                  â”‚
â”‚     where: {                                                                â”‚
â”‚       careRecipient: {                                                      â”‚
â”‚         familyId: user.currentFamilyId  // Scoped to user's family          â”‚
â”‚       }                                                                     â”‚
â”‚     }                                                                       â”‚
â”‚   });                                                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Event-Driven Architecture

### Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EVENT-DRIVEN ARCHITECTURE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   WHY EVENT-DRIVEN?                                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚                                                                             â”‚
â”‚   WITHOUT Events:                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ async logMedication(dto: LogMedicationDto) {                        â”‚   â”‚
â”‚   â”‚   const log = await this.medicationRepo.save(dto);                  â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   // All of this runs IN THE REQUEST                                â”‚   â”‚
â”‚   â”‚   await this.sendPushNotifications(log);      // 200ms              â”‚   â”‚
â”‚   â”‚   await this.sendWebSocketUpdate(log);        // 50ms               â”‚   â”‚
â”‚   â”‚   await this.createAuditLog(log);             // 100ms              â”‚   â”‚
â”‚   â”‚   await this.updateDashboardCache(log);       // 75ms               â”‚   â”‚
â”‚   â”‚   await this.checkForInteractions(log);       // 150ms              â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   return log;  // Total: 575ms+ response time! ğŸ˜±                   â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   WITH Events:                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ async logMedication(dto: LogMedicationDto) {                        â”‚   â”‚
â”‚   â”‚   const log = await this.medicationRepo.save(dto);                  â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   // Just publish event and return immediately!                     â”‚   â”‚
â”‚   â”‚   await this.eventPublisher.publish(                                â”‚   â”‚
â”‚   â”‚     'medication.logged',                                            â”‚   â”‚
â”‚   â”‚     { medicationId: log.id, status: log.status, ... }               â”‚   â”‚
â”‚   â”‚   );                                                                â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   return log;  // Response in ~20ms! ğŸš€                             â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ // Everything else happens ASYNCHRONOUSLY via consumers             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EVENT FLOW DIAGRAM                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚      API Service        â”‚                              â”‚
â”‚                    â”‚  (MedicationsService)   â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                â”‚                                            â”‚
â”‚                                â”‚ 1. Save to DB                              â”‚
â”‚                                â–¼                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚       PostgreSQL        â”‚                              â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                              â”‚
â”‚                    â”‚  â”‚ medication_logs â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚ event_outbox â†â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€ 2. Write to outbox         â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    (same transaction)        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                â”‚                                            â”‚
â”‚                                â”‚ 3. Outbox processor reads                  â”‚
â”‚                                â–¼    every 10 seconds                        â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚    Outbox Processor     â”‚                              â”‚
â”‚                    â”‚    (Cron Job)           â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                â”‚                                            â”‚
â”‚                                â”‚ 4. Publish to RabbitMQ                     â”‚
â”‚                                â–¼                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚       RabbitMQ          â”‚                              â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                              â”‚
â”‚                    â”‚  â”‚ Domain Exchange â”‚â”€â”€â”€â”€â”¼â”€â”€â”                           â”‚
â”‚                    â”‚  â”‚    (topic)      â”‚    â”‚  â”‚                           â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚                           â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                           â”‚
â”‚                                                 â”‚                           â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚          â”‚                                      â”‚                  â”‚        â”‚
â”‚          â–¼                                      â–¼                  â–¼        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   WebSocket     â”‚                 â”‚  Notification   â”‚  â”‚    Audit    â”‚  â”‚
â”‚   â”‚   Consumer      â”‚                 â”‚   Consumer      â”‚  â”‚   Consumer  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                                   â”‚                  â”‚         â”‚
â”‚            â”‚ 5a. Emit via Socket.io            â”‚ 5b. Send push    â”‚ 5c. Log â”‚
â”‚            â–¼                                   â–¼                  â–¼         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ Family Members  â”‚                 â”‚  Push Service   â”‚  â”‚ Audit Log   â”‚  â”‚
â”‚   â”‚    (Browser)    â”‚                 â”‚ (Web Push/FCM)  â”‚  â”‚  (DB/SIEM)  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CloudEvents Format

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CLOUDEVENTS FORMAT                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   We follow the CloudEvents specification (v1.0) for all events:            â”‚
â”‚                                                                             â”‚
â”‚   {                                                                         â”‚
â”‚     "specversion": "1.0",           // CloudEvents version                  â”‚
â”‚     "id": "550e8400-e29b-41d4-...", // Unique event ID (UUID)               â”‚
â”‚     "type": "medication.logged",     // Event type (dot notation)           â”‚
â”‚     "source": "/api/v1/medications/123/log",  // Origin of event            â”‚
â”‚     "time": "2024-01-15T10:30:00Z", // ISO 8601 timestamp                   â”‚
â”‚     "datacontenttype": "application/json",                                  â”‚
â”‚     "data": {                       // Actual payload                       â”‚
â”‚       "medicationId": "med_abc123",                                         â”‚
â”‚       "careRecipientId": "cr_xyz789",                                       â”‚
â”‚       "familyId": "fam_123456",                                             â”‚
â”‚       "status": "GIVEN",                                                    â”‚
â”‚       "loggedById": "usr_sarah",                                            â”‚
â”‚       "loggedByName": "Sarah Thompson",                                     â”‚
â”‚       "medicationName": "Metformin 500mg",                                  â”‚
â”‚       "scheduledTime": "2024-01-15T08:00:00Z"                               â”‚
â”‚     }                                                                       â”‚
â”‚   }                                                                         â”‚
â”‚                                                                             â”‚
â”‚   Why CloudEvents?                                                          â”‚
â”‚   â€¢ Industry standard for event format                                      â”‚
â”‚   â€¢ Self-describing (includes metadata)                                     â”‚
â”‚   â€¢ Easy to route, filter, and process                                      â”‚
â”‚   â€¢ Compatible with many tools and platforms                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Real-Time Features

### WebSocket Implementation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WEBSOCKET IMPLEMENTATION                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   BACKEND (NestJS Gateway):                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ @WebSocketGateway({                                                 â”‚   â”‚
â”‚   â”‚   cors: { origin: FRONTEND_URL, credentials: true },                â”‚   â”‚
â”‚   â”‚   namespace: '/carecircle',                                         â”‚   â”‚
â”‚   â”‚ })                                                                  â”‚   â”‚
â”‚   â”‚ export class CareCircleGateway implements OnGatewayConnection {     â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   // Map: familyId â†’ Set of socket IDs                              â”‚   â”‚
â”‚   â”‚   private familyRooms = new Map<string, Set<string>>();             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   async handleConnection(client: Socket) {                          â”‚   â”‚
â”‚   â”‚     // 1. Verify JWT from cookie                                    â”‚   â”‚
â”‚   â”‚     const token = client.handshake.headers.cookie?.accessToken;     â”‚   â”‚
â”‚   â”‚     const user = await this.jwtService.verify(token);               â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚     // 2. Join user to their family's room                          â”‚   â”‚
â”‚   â”‚     client.join(`family:${user.familyId}`);                         â”‚   â”‚
â”‚   â”‚   }                                                                 â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   // Called by WebSocket consumer when events arrive                â”‚   â”‚
â”‚   â”‚   sendToFamily(familyId: string, event: string, data: any) {        â”‚   â”‚
â”‚   â”‚     this.server.to(`family:${familyId}`).emit(event, data);         â”‚   â”‚
â”‚   â”‚   }                                                                 â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   FRONTEND (React Hook):                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ // hooks/use-websocket.ts                                           â”‚   â”‚
â”‚   â”‚ export function useWebSocket() {                                    â”‚   â”‚
â”‚   â”‚   const [socket, setSocket] = useState<Socket | null>(null);        â”‚   â”‚
â”‚   â”‚   const queryClient = useQueryClient();                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   useEffect(() => {                                                 â”‚   â”‚
â”‚   â”‚     const socket = io(`${API_URL}/carecircle`, {                    â”‚   â”‚
â”‚   â”‚       withCredentials: true,  // Send cookies                       â”‚   â”‚
â”‚   â”‚       transports: ['websocket', 'polling'],                         â”‚   â”‚
â”‚   â”‚     });                                                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚     // Update React Query cache when events arrive                  â”‚   â”‚
â”‚   â”‚     socket.on('medication.logged', (data) => {                      â”‚   â”‚
â”‚   â”‚       queryClient.invalidateQueries(['medications']);               â”‚   â”‚
â”‚   â”‚       toast.info(`${data.loggedByName} logged ${data.medicationName}`);â”‚ â”‚
â”‚   â”‚     });                                                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚     socket.on('emergency.alert.created', (data) => {                â”‚   â”‚
â”‚   â”‚       // Critical: show modal, play sound!                          â”‚   â”‚
â”‚   â”‚       showEmergencyModal(data);                                     â”‚   â”‚
â”‚   â”‚       playAlertSound();                                             â”‚   â”‚
â”‚   â”‚     });                                                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚     setSocket(socket);                                              â”‚   â”‚
â”‚   â”‚     return () => socket.close();                                    â”‚   â”‚
â”‚   â”‚   }, []);                                                           â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   return socket;                                                    â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Push Notifications

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PUSH NOTIFICATIONS                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   We use Web Push API (VAPID) for push notifications:                       â”‚
â”‚                                                                             â”‚
â”‚   1. USER SUBSCRIBES (Frontend):                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ // Register service worker                                          â”‚   â”‚
â”‚   â”‚ const registration = await navigator.serviceWorker.register('/sw.js');â”‚  â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ // Subscribe to push                                                â”‚   â”‚
â”‚   â”‚ const subscription = await registration.pushManager.subscribe({     â”‚   â”‚
â”‚   â”‚   userVisibleOnly: true,                                            â”‚   â”‚
â”‚   â”‚   applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY),    â”‚   â”‚
â”‚   â”‚ });                                                                 â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ // Send subscription to backend                                     â”‚   â”‚
â”‚   â”‚ await api.post('/notifications/subscribe', subscription);           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   2. BACKEND STORES SUBSCRIPTION:                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ // Stored in push_subscriptions table                               â”‚   â”‚
â”‚   â”‚ { userId, endpoint, keys: { p256dh, auth }, createdAt }             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   3. NOTIFICATION CONSUMER SENDS PUSH:                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ async sendPushNotificationToUser(userId: string, title: string, body: string) {â”‚
â”‚   â”‚   const subscriptions = await this.pushSubRepo.find({ where: { userId } });â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   for (const sub of subscriptions) {                                â”‚   â”‚
â”‚   â”‚     await webpush.sendNotification(                                 â”‚   â”‚
â”‚   â”‚       sub,                                                          â”‚   â”‚
â”‚   â”‚       JSON.stringify({ title, body, icon: '/icon.png' }),           â”‚   â”‚
â”‚   â”‚       {                                                             â”‚   â”‚
â”‚   â”‚         vapidDetails: {                                             â”‚   â”‚
â”‚   â”‚           subject: 'mailto:noreply@carecircle.com',                 â”‚   â”‚
â”‚   â”‚           publicKey: VAPID_PUBLIC_KEY,                              â”‚   â”‚
â”‚   â”‚           privateKey: VAPID_PRIVATE_KEY,                            â”‚   â”‚
â”‚   â”‚         },                                                          â”‚   â”‚
â”‚   â”‚       }                                                             â”‚   â”‚
â”‚   â”‚     );                                                              â”‚   â”‚
â”‚   â”‚   }                                                                 â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   4. SERVICE WORKER RECEIVES PUSH:                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ // public/sw.js                                                     â”‚   â”‚
â”‚   â”‚ self.addEventListener('push', (event) => {                          â”‚   â”‚
â”‚   â”‚   const data = event.data.json();                                   â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   event.waitUntil(                                                  â”‚   â”‚
â”‚   â”‚     self.registration.showNotification(data.title, {                â”‚   â”‚
â”‚   â”‚       body: data.body,                                              â”‚   â”‚
â”‚   â”‚       icon: data.icon,                                              â”‚   â”‚
â”‚   â”‚       badge: '/badge.png',                                          â”‚   â”‚
â”‚   â”‚       vibrate: [200, 100, 200],  // For emergencies                 â”‚   â”‚
â”‚   â”‚     })                                                              â”‚   â”‚
â”‚   â”‚   );                                                                â”‚   â”‚
â”‚   â”‚ });                                                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Frontend Architecture

### Next.js App Router Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND ARCHITECTURE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   app/                                                                      â”‚
â”‚   â”œâ”€â”€ layout.tsx              # Root layout with providers                  â”‚
â”‚   â”œâ”€â”€ page.tsx                # Landing page (/)                            â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â”€ (auth)/                 # Auth route group (public)                   â”‚
â”‚   â”‚   â”œâ”€â”€ layout.tsx          # Centered auth layout                        â”‚
â”‚   â”‚   â”œâ”€â”€ login/page.tsx      # /login                                      â”‚
â”‚   â”‚   â”œâ”€â”€ register/page.tsx   # /register                                   â”‚
â”‚   â”‚   â””â”€â”€ accept-invite/[token]/page.tsx  # /accept-invite/abc123           â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â””â”€â”€ (app)/                  # App route group (protected)                 â”‚
â”‚       â”œâ”€â”€ layout.tsx          # App shell with sidebar/nav                  â”‚
â”‚       â”œâ”€â”€ page.tsx            # /dashboard (home)                           â”‚
â”‚       â”œâ”€â”€ care/               # Care recipient routes                       â”‚
â”‚       â”‚   â””â”€â”€ [id]/           # /care/cr_abc123                             â”‚
â”‚       â”‚       â”œâ”€â”€ page.tsx    # Care recipient overview                     â”‚
â”‚       â”‚       â”œâ”€â”€ medications/page.tsx                                      â”‚
â”‚       â”‚       â”œâ”€â”€ calendar/page.tsx                                         â”‚
â”‚       â”‚       â””â”€â”€ ...                                                       â”‚
â”‚       â”œâ”€â”€ family/page.tsx     # /family                                     â”‚
â”‚       â””â”€â”€ settings/page.tsx   # /settings                                   â”‚
â”‚                                                                             â”‚
â”‚   LAYOUT HIERARCHY:                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ RootLayout (providers: React Query, Auth, Toast)                    â”‚   â”‚
â”‚   â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ AuthLayout (centered card)                                    â”‚   â”‚
â”‚   â”‚   â”‚     â””â”€â”€ Login / Register / Accept Invite                        â”‚   â”‚
â”‚   â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚   â””â”€â”€ AppLayout (sidebar + content)                                 â”‚   â”‚
â”‚   â”‚         â”œâ”€â”€ Dashboard                                               â”‚   â”‚
â”‚   â”‚         â”œâ”€â”€ Care Recipient Pages                                    â”‚   â”‚
â”‚   â”‚         â””â”€â”€ Settings                                                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Fetching with React Query

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      REACT QUERY PATTERN                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   1. API CLIENT (lib/api/client.ts):                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ const api = axios.create({                                          â”‚   â”‚
â”‚   â”‚   baseURL: process.env.NEXT_PUBLIC_API_URL,                         â”‚   â”‚
â”‚   â”‚   withCredentials: true,  // Send cookies                           â”‚   â”‚
â”‚   â”‚ });                                                                 â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ // Auto-refresh on 401                                              â”‚   â”‚
â”‚   â”‚ api.interceptors.response.use(                                      â”‚   â”‚
â”‚   â”‚   (response) => response,                                           â”‚   â”‚
â”‚   â”‚   async (error) => {                                                â”‚   â”‚
â”‚   â”‚     if (error.response?.status === 401 && !error.config._retry) {   â”‚   â”‚
â”‚   â”‚       error.config._retry = true;                                   â”‚   â”‚
â”‚   â”‚       await api.post('/auth/refresh');                              â”‚   â”‚
â”‚   â”‚       return api(error.config);                                     â”‚   â”‚
â”‚   â”‚     }                                                               â”‚   â”‚
â”‚   â”‚     throw error;                                                    â”‚   â”‚
â”‚   â”‚   }                                                                 â”‚   â”‚
â”‚   â”‚ );                                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   2. DOMAIN API FUNCTIONS (lib/api/medications.ts):                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ export const medicationsApi = {                                     â”‚   â”‚
â”‚   â”‚   getAll: (recipientId: string) =>                                  â”‚   â”‚
â”‚   â”‚     api.get(`/care-recipients/${recipientId}/medications`)          â”‚   â”‚
â”‚   â”‚       .then(r => r.data),                                           â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   getSchedule: (recipientId: string, date: string) =>               â”‚   â”‚
â”‚   â”‚     api.get(`/care-recipients/${recipientId}/medications/schedule`, {â”‚  â”‚
â”‚   â”‚       params: { date }                                              â”‚   â”‚
â”‚   â”‚     }).then(r => r.data),                                           â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   logMedication: (medicationId: string, data: LogMedicationInput) =>â”‚   â”‚
â”‚   â”‚     api.post(`/medications/${medicationId}/log`, data)              â”‚   â”‚
â”‚   â”‚       .then(r => r.data),                                           â”‚   â”‚
â”‚   â”‚ };                                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   3. HOOKS (hooks/use-medications.ts):                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ export function useMedicationSchedule(recipientId: string, date: string) {â”‚
â”‚   â”‚   return useQuery({                                                 â”‚   â”‚
â”‚   â”‚     queryKey: ['medications', recipientId, 'schedule', date],       â”‚   â”‚
â”‚   â”‚     queryFn: () => medicationsApi.getSchedule(recipientId, date),   â”‚   â”‚
â”‚   â”‚     staleTime: 1000 * 60,  // 1 minute                              â”‚   â”‚
â”‚   â”‚   });                                                               â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ export function useLogMedication() {                                â”‚   â”‚
â”‚   â”‚   const queryClient = useQueryClient();                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   return useMutation({                                              â”‚   â”‚
â”‚   â”‚     mutationFn: medicationsApi.logMedication,                       â”‚   â”‚
â”‚   â”‚     onMutate: async ({ medicationId, status }) => {                 â”‚   â”‚
â”‚   â”‚       // Optimistic update                                          â”‚   â”‚
â”‚   â”‚       await queryClient.cancelQueries(['medications']);             â”‚   â”‚
â”‚   â”‚       const previous = queryClient.getQueryData(['medications', ...]);â”‚  â”‚
â”‚   â”‚       queryClient.setQueryData(['medications', ...], (old) => ({    â”‚   â”‚
â”‚   â”‚         ...old,                                                     â”‚   â”‚
â”‚   â”‚         items: old.items.map(item =>                                â”‚   â”‚
â”‚   â”‚           item.id === medicationId                                  â”‚   â”‚
â”‚   â”‚             ? { ...item, status, isPending: true }                  â”‚   â”‚
â”‚   â”‚             : item                                                  â”‚   â”‚
â”‚   â”‚         )                                                           â”‚   â”‚
â”‚   â”‚       }));                                                          â”‚   â”‚
â”‚   â”‚       return { previous };                                          â”‚   â”‚
â”‚   â”‚     },                                                              â”‚   â”‚
â”‚   â”‚     onError: (err, vars, context) => {                              â”‚   â”‚
â”‚   â”‚       // Rollback on error                                          â”‚   â”‚
â”‚   â”‚       queryClient.setQueryData(['medications', ...], context.previous);â”‚ â”‚
â”‚   â”‚       toast.error('Failed to log medication');                      â”‚   â”‚
â”‚   â”‚     },                                                              â”‚   â”‚
â”‚   â”‚     onSettled: () => {                                              â”‚   â”‚
â”‚   â”‚       queryClient.invalidateQueries(['medications']);               â”‚   â”‚
â”‚   â”‚     },                                                              â”‚   â”‚
â”‚   â”‚   });                                                               â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   4. COMPONENT USAGE:                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ function MedicationCard({ medication }) {                           â”‚   â”‚
â”‚   â”‚   const { mutate: logMed, isPending } = useLogMedication();         â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   return (                                                          â”‚   â”‚
â”‚   â”‚     <Card>                                                          â”‚   â”‚
â”‚   â”‚       <h3>{medication.name}</h3>                                    â”‚   â”‚
â”‚   â”‚       <Button                                                       â”‚   â”‚
â”‚   â”‚         onClick={() => logMed({ medicationId: medication.id, status: 'GIVEN' })}â”‚
â”‚   â”‚         isLoading={isPending}                                       â”‚   â”‚
â”‚   â”‚       >                                                             â”‚   â”‚
â”‚   â”‚         Mark as Given                                               â”‚   â”‚
â”‚   â”‚       </Button>                                                     â”‚   â”‚
â”‚   â”‚     </Card>                                                         â”‚   â”‚
â”‚   â”‚   );                                                                â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. API Design

### RESTful Endpoints

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          API ENDPOINTS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   AUTH                                                                      â”‚
â”‚   â•â•â•â•                                                                      â”‚
â”‚   POST   /api/v1/auth/register                Create account                â”‚
â”‚   POST   /api/v1/auth/login                   Login                         â”‚
â”‚   POST   /api/v1/auth/refresh                 Refresh tokens                â”‚
â”‚   POST   /api/v1/auth/logout                  Logout                        â”‚
â”‚   POST   /api/v1/auth/forgot-password         Request reset                 â”‚
â”‚   POST   /api/v1/auth/reset-password          Reset password                â”‚
â”‚   GET    /api/v1/auth/me                      Get current user              â”‚
â”‚                                                                             â”‚
â”‚   FAMILIES                                                                  â”‚
â”‚   â•â•â•â•â•â•â•â•                                                                  â”‚
â”‚   POST   /api/v1/families                     Create family                 â”‚
â”‚   GET    /api/v1/families/:id                 Get family details            â”‚
â”‚   GET    /api/v1/families/:id/members         Get family members            â”‚
â”‚   POST   /api/v1/families/:id/invites         Invite member                 â”‚
â”‚   POST   /api/v1/invites/:token/accept        Accept invite                 â”‚
â”‚   DELETE /api/v1/families/:id/members/:uid    Remove member                 â”‚
â”‚                                                                             â”‚
â”‚   CARE RECIPIENTS                                                           â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                           â”‚
â”‚   GET    /api/v1/care-recipients              List recipients               â”‚
â”‚   POST   /api/v1/care-recipients              Create recipient              â”‚
â”‚   GET    /api/v1/care-recipients/:id          Get recipient details         â”‚
â”‚   PATCH  /api/v1/care-recipients/:id          Update recipient              â”‚
â”‚   DELETE /api/v1/care-recipients/:id          Soft delete                   â”‚
â”‚                                                                             â”‚
â”‚   MEDICATIONS                                                               â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•                                                               â”‚
â”‚   GET    /api/v1/care-recipients/:id/medications           List meds        â”‚
â”‚   POST   /api/v1/care-recipients/:id/medications           Add medication   â”‚
â”‚   GET    /api/v1/care-recipients/:id/medications/schedule  Today's schedule â”‚
â”‚   GET    /api/v1/medications/:id                           Get details      â”‚
â”‚   PATCH  /api/v1/medications/:id                           Update           â”‚
â”‚   DELETE /api/v1/medications/:id                           Deactivate       â”‚
â”‚   POST   /api/v1/medications/:id/log                       Log (given/skip) â”‚
â”‚   GET    /api/v1/medications/:id/history                   Log history      â”‚
â”‚                                                                             â”‚
â”‚   APPOINTMENTS                                                              â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•                                                              â”‚
â”‚   GET    /api/v1/care-recipients/:id/appointments          List            â”‚
â”‚   POST   /api/v1/care-recipients/:id/appointments          Create          â”‚
â”‚   GET    /api/v1/appointments/:id                          Get details     â”‚
â”‚   PATCH  /api/v1/appointments/:id                          Update          â”‚
â”‚   DELETE /api/v1/appointments/:id                          Cancel          â”‚
â”‚                                                                             â”‚
â”‚   DOCUMENTS                                                                 â”‚
â”‚   â•â•â•â•â•â•â•â•â•                                                                 â”‚
â”‚   GET    /api/v1/care-recipients/:id/documents             List            â”‚
â”‚   POST   /api/v1/care-recipients/:id/documents             Upload          â”‚
â”‚   GET    /api/v1/documents/:id                             Download        â”‚
â”‚   DELETE /api/v1/documents/:id                             Delete          â”‚
â”‚                                                                             â”‚
â”‚   TIMELINE                                                                  â”‚
â”‚   â•â•â•â•â•â•â•â•                                                                  â”‚
â”‚   GET    /api/v1/care-recipients/:id/timeline              List entries    â”‚
â”‚   POST   /api/v1/care-recipients/:id/timeline              Add entry       â”‚
â”‚   GET    /api/v1/timeline/:id                              Get entry       â”‚
â”‚   PATCH  /api/v1/timeline/:id                              Update          â”‚
â”‚   DELETE /api/v1/timeline/:id                              Delete          â”‚
â”‚                                                                             â”‚
â”‚   EMERGENCY                                                                 â”‚
â”‚   â•â•â•â•â•â•â•â•â•                                                                 â”‚
â”‚   POST   /api/v1/emergency/alert                           Trigger alert   â”‚
â”‚   POST   /api/v1/emergency/alerts/:id/resolve              Resolve alert   â”‚
â”‚   GET    /api/v1/care-recipients/:id/emergency-info        Get info        â”‚
â”‚                                                                             â”‚
â”‚   CAREGIVERS                                                                â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•                                                                â”‚
â”‚   GET    /api/v1/care-recipients/:id/shifts                List shifts     â”‚
â”‚   POST   /api/v1/care-recipients/:id/shifts                Create shift    â”‚
â”‚   POST   /api/v1/shifts/:id/check-in                       Check in        â”‚
â”‚   POST   /api/v1/shifts/:id/check-out                      Check out       â”‚
â”‚                                                                             â”‚
â”‚   NOTIFICATIONS                                                             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•                                                             â”‚
â”‚   POST   /api/v1/notifications/subscribe                   Subscribe push  â”‚
â”‚   DELETE /api/v1/notifications/subscribe                   Unsubscribe     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request/Response Examples

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API REQUEST/RESPONSE EXAMPLES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   CREATE MEDICATION                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ POST /api/v1/care-recipients/cr_abc123/medications                  â”‚   â”‚
â”‚   â”‚ Content-Type: application/json                                      â”‚   â”‚
â”‚   â”‚ Cookie: accessToken=eyJhbGci...                                     â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ {                                                                   â”‚   â”‚
â”‚   â”‚   "name": "Metformin",                                              â”‚   â”‚
â”‚   â”‚   "dosage": "500mg",                                                â”‚   â”‚
â”‚   â”‚   "frequency": "THREE_TIMES_DAILY",                                 â”‚   â”‚
â”‚   â”‚   "times": ["08:00", "14:00", "20:00"],                             â”‚   â”‚
â”‚   â”‚   "instructions": "Take with food",                                 â”‚   â”‚
â”‚   â”‚   "currentSupply": 90,                                              â”‚   â”‚
â”‚   â”‚   "refillThreshold": 15                                             â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ 201 Created                                                         â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ {                                                                   â”‚   â”‚
â”‚   â”‚   "id": "med_xyz789",                                               â”‚   â”‚
â”‚   â”‚   "careRecipientId": "cr_abc123",                                   â”‚   â”‚
â”‚   â”‚   "name": "Metformin",                                              â”‚   â”‚
â”‚   â”‚   "dosage": "500mg",                                                â”‚   â”‚
â”‚   â”‚   "frequency": "THREE_TIMES_DAILY",                                 â”‚   â”‚
â”‚   â”‚   "times": ["08:00", "14:00", "20:00"],                             â”‚   â”‚
â”‚   â”‚   "instructions": "Take with food",                                 â”‚   â”‚
â”‚   â”‚   "currentSupply": 90,                                              â”‚   â”‚
â”‚   â”‚   "refillThreshold": 15,                                            â”‚   â”‚
â”‚   â”‚   "isActive": true,                                                 â”‚   â”‚
â”‚   â”‚   "createdAt": "2024-01-15T10:30:00Z",                              â”‚   â”‚
â”‚   â”‚   "updatedAt": "2024-01-15T10:30:00Z"                               â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   LOG MEDICATION                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ POST /api/v1/medications/med_xyz789/log                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ {                                                                   â”‚   â”‚
â”‚   â”‚   "status": "GIVEN",                                                â”‚   â”‚
â”‚   â”‚   "scheduledTime": "2024-01-15T08:00:00Z",                          â”‚   â”‚
â”‚   â”‚   "notes": "Took with breakfast, no issues"                         â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   ERROR RESPONSE                                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ 400 Bad Request                                                     â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ {                                                                   â”‚   â”‚
â”‚   â”‚   "statusCode": 400,                                                â”‚   â”‚
â”‚   â”‚   "message": [                                                      â”‚   â”‚
â”‚   â”‚     "name should not be empty",                                     â”‚   â”‚
â”‚   â”‚     "dosage should not be empty"                                    â”‚   â”‚
â”‚   â”‚   ],                                                                â”‚   â”‚
â”‚   â”‚   "error": "Bad Request"                                            â”‚   â”‚
â”‚   â”‚ }                                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Security Implementation

See [AUTH_COMPLETE_GUIDE.md](./AUTH_COMPLETE_GUIDE.md) for detailed authentication documentation.

### Security Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SECURITY LAYERS                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   1. AUTHENTICATION                                                         â”‚
â”‚      â€¢ JWT access tokens (15 min expiry)                                    â”‚
â”‚      â€¢ HTTP-only cookies (XSS protection)                                   â”‚
â”‚      â€¢ Refresh token rotation                                               â”‚
â”‚      â€¢ Session tracking in database                                         â”‚
â”‚                                                                             â”‚
â”‚   2. AUTHORIZATION                                                          â”‚
â”‚      â€¢ Role-based access (ADMIN, CAREGIVER, VIEWER)                         â”‚
â”‚      â€¢ Family-scoped data access                                            â”‚
â”‚      â€¢ Resource ownership validation                                        â”‚
â”‚                                                                             â”‚
â”‚   3. INPUT VALIDATION                                                       â”‚
â”‚      â€¢ class-validator on all DTOs                                          â”‚
â”‚      â€¢ TypeORM parameterized queries (SQL injection prevention)             â”‚
â”‚      â€¢ File type validation on uploads                                      â”‚
â”‚                                                                             â”‚
â”‚   4. RATE LIMITING                                                          â”‚
â”‚      â€¢ NestJS Throttler                                                     â”‚
â”‚      â€¢ Stricter limits on auth endpoints                                    â”‚
â”‚                                                                             â”‚
â”‚   5. TRANSPORT SECURITY                                                     â”‚
â”‚      â€¢ HTTPS only in production                                             â”‚
â”‚      â€¢ Secure cookies                                                       â”‚
â”‚      â€¢ CORS configured for specific origins                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. Running the Project

### Prerequisites

- Node.js 18+
- pnpm 8+
- Docker & Docker Compose

### Quick Start

```bash
# 1. Clone the repository
git clone https://github.com/yourorg/carecircle.git
cd carecircle

# 2. Install dependencies
pnpm install

# 3. Set up environment variables
cp env.example .env
# Edit .env with your values

# 4. Start Docker services (PostgreSQL, Redis, RabbitMQ, Mailpit)
docker-compose up -d

# 5. Run database migrations
pnpm db:migrate

# 6. Seed database (optional)
pnpm db:seed

# 7. Start development servers
pnpm dev
```

### What Starts

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¡ CareCircle Development Environment                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  APPLICATIONS:                                                              â”‚
â”‚  â”œâ”€ ğŸŒ Web App      â†’ http://localhost:3000                                 â”‚
â”‚  â”œâ”€ ğŸ”Œ API Server   â†’ http://localhost:3001                                 â”‚
â”‚  â””â”€ ğŸ“š Swagger Docs â†’ http://localhost:3001/api/docs                        â”‚
â”‚                                                                             â”‚
â”‚  INFRASTRUCTURE (Docker):                                                   â”‚
â”‚  â”œâ”€ ğŸ˜ PostgreSQL   â†’ localhost:5432                                        â”‚
â”‚  â”œâ”€ ğŸ”´ Redis        â†’ localhost:6379                                        â”‚
â”‚  â”œâ”€ ğŸ° RabbitMQ     â†’ localhost:15672 (Management UI)                       â”‚
â”‚  â””â”€ ğŸ“§ Mailpit      â†’ localhost:8025 (Email testing)                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Useful Commands

```bash
# Run specific app
pnpm --filter @carecircle/api dev
pnpm --filter @carecircle/web dev

# Database commands
pnpm db:migrate          # Run migrations
pnpm db:migrate:generate # Generate new migration
pnpm db:seed             # Seed database
pnpm db:studio           # Open database GUI

# Build
pnpm build               # Build all apps
pnpm build:api           # Build API only

# Testing
pnpm test                # Run all tests
pnpm test:e2e            # Run E2E tests

# Docker
docker-compose up -d     # Start services
docker-compose down      # Stop services
docker-compose logs -f   # View logs
```

---

## 11. Deployment Guide

### Docker Production Build

```bash
# Build all Docker images
docker build -f apps/api/Dockerfile -t carecircle-api .
docker build -f apps/web/Dockerfile -t carecircle-web .
docker build -f apps/workers/Dockerfile -t carecircle-workers .

# Or use docker-compose
docker-compose -f docker-compose.prod.yml build
```

### Environment Variables (Production)

```env
# Database
DATABASE_URL=postgresql://user:pass@db-host:5432/carecircle

# Redis
REDIS_URL=redis://:password@redis-host:6379

# RabbitMQ
RABBITMQ_URL=amqps://user:pass@rabbitmq-host:5671

# JWT (use secure, unique values!)
JWT_SECRET=your-256-bit-secret-key
JWT_REFRESH_SECRET=your-different-256-bit-secret

# Frontend URL (for CORS)
FRONTEND_URL=https://app.carecircle.com

# Storage (AWS S3 for production)
AWS_S3_BUCKET=carecircle-documents
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=AKIA...
AWS_SECRET_ACCESS_KEY=...

# Email (production provider)
SMTP_HOST=email-smtp.us-east-1.amazonaws.com
SMTP_PORT=587
SMTP_USER=AKIA...
SMTP_PASS=...

# Push Notifications
VAPID_PUBLIC_KEY=...
VAPID_PRIVATE_KEY=...
```

### Kubernetes (Overview)

```yaml
# Simplified overview - see k8s/ folder for full manifests

# API Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: carecircle-api
spec:
  replicas: 3
  template:
    spec:
      containers:
        - name: api
          image: carecircle-api:latest
          ports:
            - containerPort: 3001
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "512Mi"
              cpu: "500m"

---
# Horizontal Pod Autoscaler
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: carecircle-api-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: carecircle-api
  minReplicas: 3
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
```

---

## Next Steps

1. **Start here**: [Running the Project](#10-running-the-project)
2. **Understand auth**: [AUTH_COMPLETE_GUIDE.md](./AUTH_COMPLETE_GUIDE.md)
3. **Learn events**: [EVENT_DRIVEN_ARCHITECTURE.md](../EVENT_DRIVEN_ARCHITECTURE.md)
4. **Master production**: [engineering-mastery/](../engineering-mastery/)

---

_CareCircle: Caregiving, coordinated. ğŸ¡_
